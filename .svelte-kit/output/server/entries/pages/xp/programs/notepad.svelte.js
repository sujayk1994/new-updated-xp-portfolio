import{c as R,a as b,v as j,e as V,j as q}from"../../../../_app/immutable/chunks/index-ff400fad.js";import{W as J}from"../../../../_app/immutable/chunks/Window-e98aeb2f.js";import{z as U,h as G,a as N,r as K}from"../../../../_app/immutable/chunks/store-3e4ea696.js";import{c as T}from"../../../../_app/immutable/chunks/utils-a62a4de9.js";import{M as L}from"../../../../_app/immutable/chunks/Menu-9b4db4a8.js";import{g as Q,s as X,a as Y}from"../../../../_app/immutable/chunks/fs-8c49ae47.js";import Z from"short-uuid";import"../../../../_app/immutable/chunks/TitleBar-7840ae1a.js";import"lodash";import"idb-keyval";import"../../../../_app/immutable/chunks/index-2945f287.js";import"../../../../_app/immutable/chunks/system-eda41220.js";import"../../../../_app/immutable/chunks/finder-762cc408.js";import"buffer";import"../../../../_app/immutable/chunks/admin-04ad1b95.js";let z="Notepad";async function $({node_ref:d,filetypes_desc:o,filetypes:t}){return new Promise(async(f,c)=>{const m=(await import("../../../../_app/immutable/chunks/OpenModal-16ae08fb.js")).default;let s=new m({target:d,props:{filetypes:t,filetypes_desc:o}});s.self=s,s.on_open=()=>{f(s.selected_items),s.destroy()}})}async function ee({node_ref:d,filetypes:o,id:t,current_filetype:f}){return new Promise(async(c,m)=>{const s=(await import("../../../../_app/immutable/chunks/SaveModal-661c5409.js")).default;let a=new s({target:d,props:{filetypes:o,selected_filetype:f,id:t}});a.self=a,a.on_save=()=>{c({parent_id:a.parent_id,filename:a.filename,selected_filetype:a.selected_filetype}),a.destroy()}})}async function te({node_ref:d,title:o,message:t,icon:f,yes_action:c,no_action:m}){const s=(await import("../../../../_app/immutable/chunks/Dialog-20b8e919.js")).default;let a=[{name:"Save",action:()=>{c(),n.destroy()},focus:!0},{name:"Don't Save",action:()=>{m(),n.destroy()}},{name:"Cancel",action:()=>{n.destroy()}}],n=new s({target:d,props:{icon:f,title:o,message:t,buttons:a,button_align:"center"}});n.self=n}const ve=R((d,o,t,f)=>{let c,m,s;c=b(U,e=>e),s=b(G,e=>m=e);let{id:a}=o,{window:n}=o,{self:p}=o,{parentNode:S}=o,{fs_item:i}=o,{exec_path:v}=o,l,w=!1,{options:y={title:z,min_width:300,min_height:200,width:600,height:500,icon:"/images/xp/icons/Notepad.png",id:a,exec_path:v}}=o,A=[{name:"File",items:[[{name:"Open",action:C}],[{name:"Save",action:D},{name:"Save As",action:k}],[{name:"Exit",action:u}]]},{name:"Edit",items:[[{name:"Undo",action:()=>l.contentWindow.undo()},{name:"Redo",action:()=>l.contentWindow.redo()}],[{name:"Find",action:()=>l.contentWindow.find()},{name:"Replace",action:()=>l.contentWindow.replace()}],[{name:"Date/Time",action:()=>l.contentWindow.insert(new Date().toDateString())}]]},{name:"Format",items:[[{name:"Word Wrap",action:()=>l.contentWindow.toggle_wrap()}]]},{name:"View",items:[[{name:"Status Bar"}]]},{name:"Help",items:[[{name:"Help Topics",action:()=>{N.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}},{name:"About Notepad",action:()=>{N.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}}]]}],h=[{name:"Plain Text (.txt)",ext:".txt"},{name:"Web Page (.html)",ext:".html"},{name:"Markdown (.md)",ext:".md"},{name:"Javascript (.js)",ext:".js"},{name:"VBScript (.vbs)",ext:".vbs"}];async function C(){let e=await B({filetypes_desc:"All Files",filetypes:[]});if(i||w)N.set({path:"./programs/notepad.svelte",fs_item:e});else{i=e;let _=await(await Q(i.id)).text();l.contentWindow.set_content(_),l.contentWindow.set_mode(i.name)}}async function u(){if(w){let e=()=>{x()},r=async()=>{await D(),x()};te({node_ref:n.node_ref,title:"Save Changes",message:"Do you want to save the changes you've made before closing this document?",yes_action:r,no_action:e})}else x()}function x(){K.update(e=>e.filter(r=>r!=p)),p.$destroy()}async function B({filetypes_desc:e,filetypes:r}){let _=await $({node_ref:n.node_ref,filetypes_desc:e,filetypes:r});return m[_[0]]}async function D(){if(i!=null){let e=l.contentWindow.get_content(),r=new File([e],i.name,{type:T(i.ext)});X(i.id,r),l.contentWindow.set_mode(i.name),n.show_toast({message:"Changes Saved!",theme:"light"})}else await k();l.contentWindow.set_clean(),w=!1}async function k(){console.log(i);let e=h.find(O=>O.ext==i?.ext);e==null&&(e=h[0]);let{parent_id:r,filename:_,selected_filetype:W}=await ee({id:i?.parent,node_ref:n.node_ref,filetypes:h,current_filetype:e}),H=T(W.ext),I=l.contentWindow.get_content(),M=new File([I],_,{type:H});console.log(M);let P=Z.generate();await Y(_,W.ext,M,r,P),i==null&&(i=m[P])}function E(){setTimeout(()=>{},500)}o.id===void 0&&t.id&&a!==void 0&&t.id(a),o.window===void 0&&t.window&&n!==void 0&&t.window(n),o.self===void 0&&t.self&&p!==void 0&&t.self(p),o.parentNode===void 0&&t.parentNode&&S!==void 0&&t.parentNode(S),o.fs_item===void 0&&t.fs_item&&i!==void 0&&t.fs_item(i),o.exec_path===void 0&&t.exec_path&&v!==void 0&&t.exec_path(v),o.options===void 0&&t.options&&y!==void 0&&t.options(y),o.destroy===void 0&&t.destroy&&u!==void 0&&t.destroy(u);let g,F;do{g=!0;{let e="";i?e=i.name:e=z,w&&(e+=" *"),n&&n.update_title(e)}F=`



${j(J,"Window").$$render(d,{options:y,on_click_close:u,on_focused:E,this:n},{this:e=>{n=e,g=!1}},{content:()=>`<div slot="content" class="absolute inset-1 top-0 flex flex-col bg-xp-yellow">${j(L,"Menu").$$render(d,{menu:A},{},{})}
        
        <div class="absolute inset-0 top-[25px] overflow-auto bg-slate-50 font-sans"><iframe src="/html/notepad/index.html" class="w-full h-full" style="${"visibility: "+V("hidden",!0)}" frameborder="0"${q("this",l,0)}></iframe></div></div>`})}

`}while(!g);return c(),s(),F});export{ve as default};
