import{c as A,a as n,d as E,l as H,j,f as p,e as o,v as K,h as F}from"../../../../../_app/immutable/chunks/index-ff400fad.js";import{z as U,h as V,b as P,d as X,e as q}from"../../../../../_app/immutable/chunks/store-3e4ea696.js";import"../../../../../_app/immutable/chunks/finder-762cc408.js";import{c as B,h as G,p as J,i as C}from"../../../../../_app/immutable/chunks/system-eda41220.js";import"short-uuid";import{get as N,set as Q}from"idb-keyval";import"buffer";import"lodash";import Y from"dragselect";import{P as Z}from"../../../../../_app/immutable/chunks/Previewable-3a8a83f0.js";import ee from"hash-sum";import"../../../../../_app/immutable/chunks/index-2945f287.js";const fe=A((R,s,r,te)=>{let g,d,b,v,_,i,h,a,w,$,S,y,k;_=n(U,e=>v=e),h=n(V,e=>i=e),w=n(P,e=>a=e),S=n(X,e=>$=e),k=n(q,e=>y=e);let T=E(),{self:D}=s,{my_computer_instance:c}=s,{id:t=null}=s,M=new Worker(new URL("./sort.js",import.meta.url),{type:"module"});M.onmessage=({data:e})=>{e.type=="sorted"&&e.id==t&&(console.log("update sorted_items",t),d=e.sorted_items)};let u,m=B.map(e=>i[e]),L,{renaming:f=!1}=s;const z=new Y({customStyles:!1,draggability:!1});z.subscribe("callback",e=>{H(P,a=e.items.map(l=>l.getAttribute("fs-id")).filter(l=>i[l]!=null),a),console.log(a.map(l=>i[l]))}),new MutationObserver(e=>{z.setSettings({selectables:[]})});function I(e){return e.icon!=null?`url(${e.icon})`:C[e.ext]!=null?`url(/images/xp/icons/${C[e.ext]})`:null}async function O(){if(!await N("my_computer::read_transfer_guide")&&t!=null){const l=(await import("../../../../../_app/immutable/chunks/Dialog-20b8e919.js")).default;let W=[{name:"OK",action:()=>x.destroy(),focus:!0}],x=new l({target:c.window.node_ref,props:{title:"File Transfer",message:"Drag & drop files from your computer to the blank space in a folder to transfer them into Windows XP",buttons:W,button_align:"center"}});x.self=x,Q("my_computer::read_transfer_guide",!0)}}if(s.self===void 0&&r.self&&D!==void 0&&r.self(D),s.my_computer_instance===void 0&&r.my_computer_instance&&c!==void 0&&r.my_computer_instance(c),s.id===void 0&&r.id&&t!==void 0&&r.id(t),s.renaming===void 0&&r.renaming&&f!==void 0&&r.renaming(f),g=i[t]==null?[]:i[t].children.map(e=>i[e]).filter(e=>e!=null).filter(e=>!G.includes(e.id)),d=null,i[t]){let e={id:t,items:g,sort_option:i[t].sort_option,sort_order:i[t].sort_order},l=ee(e);console.log({hash:l}),l!=u&&(u=l,M.postMessage({type:"sort",hash:l,...e}))}else u=null;return b=v==c?.window.z_index,t!=null&&i[t]==null&&T("open",{id:null}),O(),_(),h(),w(),S(),k(),`<div class="absolute inset-0 overflow-auto bg-slate-50"${j("this",L,0)}><div class="${["w-full min-h-[90%]",t==null?"hidden":""].join(" ").trim()}">${d?`${p(d,e=>`<div${j("fs-id",e.id,0)} class="${"fs-item w-[150px] overflow-hidden m-2 inline-flex flex-row items-center font-MSSS relative "+o($.includes(e.id)&&y=="cut"?"opacity-70":"",!0)}">${J.includes(e.ext)?`${K(Z,"Previewable").$$render(R,{default_icon:I(e),fs_id:e.id},{},{})}`:`<div class="${"w-[50px] h-[50px] shrink-0 bg-contain bg-no-repeat bg-center "+o(e.type=="folder"?"bg-[url(/images/xp/icons/FolderClosed.png)]":"bg-[url(/images/xp/icons/Default.png)]",!0)}"${F({"background-image":I(e)})}></div>`}
                    <p class="${"px-1 mx-0.5 text-[11px] break-words line-clamp-2 text-ellipsis leading-tight "+o(a?.includes(e.id)&&b?"bg-blue-600 text-slate-50":"",!0)}">${o(e.name)}</p>
                    ${a.includes(e.id)&&f?`<textarea autofocus class="absolute max-h-[40px] right-0 top-2 left-[50px] overflow-hidden outline-none border border-slate-900 text-[11px] font-MSSS z-50 resize-none">${o(e.name,!0)}</textarea>`:""}
                    
                </div>`)}`:'<p class="text-center text-sm font-Trebuchet my-2 text-slate-500">working on it...</p>'}</div>

    <div class="${["w-full",t!=null?"hidden":""].join(" ").trim()}"><p class="ml-2 mt-0.5 font-MSSS text-black text-[11px] font-bold">Files Stored on This Computer</p>
        <div class="mb-4 w-[300px] h-[2px] bg-gradient-to-r from-blue-500 to-slate-50"></div>
        ${p(m.filter(e=>e.type=="folder"),e=>`<div class="w-[150px] ml-4 mr-8 overflow-hidden inline-flex flex-row items-center font-MSSS"><div class="w-[50px] h-[50px] shrink-0 bg-[url(/images/xp/icons/FolderClosed.png)] bg-contain"${F({"background-image":e.icon==null?"":`url(${e.icon})`})}></div>
                <div class="px-1 text-[11px] line-clamp-2 text-ellipsis leading-tight">${o(e.display_name!=null?e.display_name:e.name)}</div>
            </div>`)}

        <p class="ml-2 mt-4 font-MSSS text-black text-[11px] font-bold">Hard Disk Drives</p>
        <div class="mb-4 w-[300px] h-[2px] bg-gradient-to-r from-blue-500 to-slate-50"></div>
        ${p(m.filter(e=>e.type=="drive"),e=>`<div class="w-[150px] ml-4 mr-8 overflow-hidden inline-flex flex-row items-center font-MSSS"><div class="w-[50px] h-[50px] shrink-0 bg-[url(/images/xp/icons/LocalDisk.png)] bg-contain"></div>
                <div class="px-1 text-[11px] line-clamp-2 text-ellipsis leading-tight">${o(e.display_name!=null?e.display_name:e.name)}</div>
            </div>`)}

        <p class="ml-2 mt-4 font-MSSS text-black text-[11px] font-bold">Devices with Removable Storage</p>
        <div class="mb-4 w-[300px] h-[2px] bg-gradient-to-r from-blue-500 to-slate-50"></div>
        ${p(m.filter(e=>e.type=="removable_storage"),e=>`<div class="w-[150px] ml-4 mr-8 overflow-hidden inline-flex flex-row items-center font-MSSS"><div class="w-[50px] h-[50px] shrink-0 bg-[url(/images/xp/icons/RemovableMedia.png)] bg-contain"></div>
                <div class="px-1 text-[11px] line-clamp-2 text-ellipsis leading-tight">${o(e.display_name!=null?e.display_name:e.name)}</div>
            </div>`)}</div></div>


`});export{fe as default};
