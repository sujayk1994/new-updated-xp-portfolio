import{v as p}from"../../../../_app/immutable/chunks/auth-e33c57ab.js";import{q as s,i as T}from"../../../../_app/immutable/chunks/db-aae5410a.js";import"bcrypt";import"jsonwebtoken";import"crypto";import"pg";let a=!1;async function i(){a||(await T(),await s(`
            CREATE TABLE IF NOT EXISTS about_me_content (
                id SERIAL PRIMARY KEY,
                content JSONB NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        `),a=!0)}function E(e){const r=e.headers.get("cookie")||"",t=Object.fromEntries(r.split(";").map(o=>{const[c,...u]=o.trim().split("=");return[c,u.join("=")]})).admin_token;return t?p(t):null}async function S(){await i();try{const e=await s("SELECT content FROM about_me_content ORDER BY id DESC LIMIT 1");return e.rows.length>0?new Response(JSON.stringify({success:!0,content:e.rows[0].content}),{status:200,headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({success:!0,content:null}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error fetching about me content:",e),new Response(JSON.stringify({success:!1,error:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}async function w({request:e}){if(await i(),!E(e))return new Response(JSON.stringify({success:!1,error:"Unauthorized - Admin access required"}),{status:401,headers:{"Content-Type":"application/json"}});try{const n=await e.json(),{content:t}=n;if(!t)return new Response(JSON.stringify({success:!1,error:"Content is required"}),{status:400,headers:{"Content-Type":"application/json"}});const o=await s("SELECT id FROM about_me_content LIMIT 1");return o.rows.length>0?await s("UPDATE about_me_content SET content = $1, updated_at = CURRENT_TIMESTAMP WHERE id = $2",[t,o.rows[0].id]):await s("INSERT INTO about_me_content (content) VALUES ($1)",[t]),new Response(JSON.stringify({success:!0,message:"About Me content saved successfully"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(n){return console.error("Error saving about me content:",n),new Response(JSON.stringify({success:!1,error:n.message}),{status:500,headers:{"Content-Type":"application/json"}})}}export{S as GET,w as POST};
