import{v as m}from"../../../../_app/immutable/chunks/auth-e33c57ab.js";import{i as d}from"../../../../_app/immutable/chunks/db-aae5410a.js";import o from"fs";import y from"path";import"bcrypt";import"jsonwebtoken";import"crypto";import"pg";let f=!1;async function g(){f||(await d(),f=!0)}function h(i){const a=i.headers.get("cookie")||"",t=Object.fromEntries(a.split(";").map(s=>{const[r,...n]=s.trim().split("=");return[r,n.join("=")]})).admin_token;return t?m(t):null}async function D({request:i}){if(await g(),!h(i))return new Response(JSON.stringify({success:!1,error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});try{const e=await i.formData(),t=e.get("file"),s=e.get("fileId");if(!t||!s)return new Response(JSON.stringify({success:!1,error:"Missing file or fileId"}),{status:400,headers:{"Content-Type":"application/json"}});const r="static/uploads/admin";o.existsSync(r)||o.mkdirSync(r,{recursive:!0});const n=`${s}_${t.name.replace(/[^a-zA-Z0-9._-]/g,"_")}`,l=y.join(r,n),p=await t.arrayBuffer(),c=Buffer.from(p);o.writeFileSync(l,c);const u=`/uploads/admin/${n}`;return new Response(JSON.stringify({success:!0,url:u,size:Math.ceil(c.length/1024)}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error uploading file:",e),new Response(JSON.stringify({success:!1,error:e.message}),{status:500,headers:{"Content-Type":"application/json"}})}}export{D as POST};
