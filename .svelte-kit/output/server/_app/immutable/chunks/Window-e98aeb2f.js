import{c as O,a as X,h as A,i as D,j as Y,e as j,v as F}from"./index-ff400fad.js";import{T as G}from"./TitleBar-7840ae1a.js";import"lodash";import{set as J}from"idb-keyval";import{r as q,z as T}from"./store-3e4ea696.js";function E(n){return n==null?{x:document.body.offsetWidth*.5,y:document.body.offsetHeight*.5}:{x:n.x+n.width*.5,y:n.y+n.height*.5}}const Z=O((n,t,e,W)=>{let B,r,C;B=X(q,i=>i),C=X(T,i=>r=i);let{options:d={}}=t,_,{node_ref:l}=t,H,{maximized:c}=t,{minimized:f}=t,v="",y="",{on_focused:p=()=>{}}=t,{z_index:s=0}=t,{on_click_close:w=()=>{}}=t,{on_click_maximize:u=()=>{!d.resizable||(f=!1,c?(x(H),c=!1):(H={top:l.offsetTop,left:l.offsetLeft,width:l.offsetWidth,height:l.offsetHeight},x({top:0,left:0,width:l.parentNode.offsetWidth,height:l.parentNode.offsetHeight}),c=!0),m())}}=t,{on_click_minimize:z=()=>{let i=E(l.getBoundingClientRect()),a=E(document.querySelector(`.program-tile[program-id="${d.id}"]`)?.getBoundingClientRect());v=`translateX(${a.x-i.x}px)`,y=`translateY(${a.y-i.y}px)`,console.log(`${v} ${y} scale(0.1)`),f=!0,k()}}=t;function I(){f?f=!1:c&&u(),m()}function m(){s!=r&&(T.update(i=>i+1),s=r,p())}function k(){s==r&&(console.log("loose focus"),T.update(i=>i+1))}function x({top:i,left:a,width:o,height:h}){l.style.top=`${i}px`,l.style.left=`${a}px`,l.style.width=`${o}px`,l.style.height=`${h}px`,d.exec_path&&J(d.exec_path,l.getBoundingClientRect())}function R(i){_.update_icon(i)}function N(i){q.update(a=>{let o=a.find(L=>L.options.id==d.id),h=a.indexOf(o);return h>=0&&(a[h].options.title=i),a}),_.update_title(i)}function P({theme:i="dark",message:a}){let o=document.createElement("div");o.style.position="absolute",o.style.transform="translate(-50%)",o.style.left="50%",o.style.top="50%",o.style.padding="10px",o.innerText=a,o.style.borderRadius="7px",o.style.opacity=1,o.style.fontSize="12px",o.style.minHeight="30px",o.style.minWidth="70px",o.style.zIndex=99999,i=="dark"?(o.style.backgroundColor="#0f172a",o.style.border="1px solid #f1f5f9",o.style.color="#f8fafc"):(o.style.backgroundColor="#f1f5f9",o.style.border="1px solid #1e293b",o.style.color="#0f172a"),l.append(o),setTimeout(()=>{o.remove()},3e3)}t.options===void 0&&e.options&&d!==void 0&&e.options(d),t.node_ref===void 0&&e.node_ref&&l!==void 0&&e.node_ref(l),t.maximized===void 0&&e.maximized&&c!==void 0&&e.maximized(c),t.minimized===void 0&&e.minimized&&f!==void 0&&e.minimized(f),t.on_focused===void 0&&e.on_focused&&p!==void 0&&e.on_focused(p),t.z_index===void 0&&e.z_index&&s!==void 0&&e.z_index(s),t.on_click_close===void 0&&e.on_click_close&&w!==void 0&&e.on_click_close(w),t.on_click_maximize===void 0&&e.on_click_maximize&&u!==void 0&&e.on_click_maximize(u),t.on_click_minimize===void 0&&e.on_click_minimize&&z!==void 0&&e.on_click_minimize(z),t.restore===void 0&&e.restore&&I!==void 0&&e.restore(I),t.focus===void 0&&e.focus&&m!==void 0&&e.focus(m),t.loose_focus===void 0&&e.loose_focus&&k!==void 0&&e.loose_focus(k),t.set_position===void 0&&e.set_position&&x!==void 0&&e.set_position(x),t.update_icon===void 0&&e.update_icon&&R!==void 0&&e.update_icon(R),t.update_title===void 0&&e.update_title&&N!==void 0&&e.update_title(N),t.show_toast===void 0&&e.show_toast&&P!==void 0&&e.show_toast(P);let g,S;do g=!0,S=`<div${A(D("opacity:0; position: absolute; border-top-left-radius: 8px; border-top-right-radius: 8px; padding: 0px; -webkit-font-smoothing: antialiased;",{width:`${d.width}px`,height:`${d.height}px`,"min-width":`${d.min_width}px`,"min-height":`${d.min_height}px`,transform:f?`${v} ${y} scale(0.1)`:"none",background:d.background,"z-index":s,"box-shadow":s<r?"var(--window-box-shadow-inactive)":"var(--window-box-shadow)"}))}${Y("program-id",d.id,0)} class="${"window absolute flex flex-col bg-xp-yellow "+j("",!0)+" "+j(f?"opacity-0":"",!0)}"${Y("this",l,0)}><div class="shrink-0">${F(G,"TitleBar").$$render(n,{options:d,inactive:s<r,maximized:c,on_click_close:w,on_click_maximize:u,on_click_minimize:z,this:_},{this:i=>{_=i,g=!1}},{})}</div>

    <div class="grow shrink-0 relative shadow-xl">${W.content?W.content({}):""}</div></div>

`;while(!g);return B(),C(),S});export{Z as W};
