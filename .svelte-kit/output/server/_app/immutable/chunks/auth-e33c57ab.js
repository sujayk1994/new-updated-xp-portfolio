import a from"bcrypt";import o from"jsonwebtoken";import c from"crypto";import{q as t}from"./db-aae5410a.js";const i=process.env.JWT_SECRET||c.randomBytes(64).toString("hex"),u=10;process.env.JWT_SECRET||console.warn("WARNING: JWT_SECRET not set in environment. Using randomly generated secret. Sessions will be invalidated on server restart.");async function T(r,n){const s=await a.hash(n,u);try{return await t("INSERT INTO admin_users (username, password_hash) VALUES ($1, $2)",[r,s]),{success:!0}}catch(e){if(e.code==="23505")return{success:!1,error:"Admin already exists"};throw e}}async function p(r,n){const s=await t("SELECT * FROM admin_users WHERE username = $1",[r]);if(s.rows.length===0)return null;const e=s.rows[0];return await a.compare(n,e.password_hash)?{id:e.id,username:e.username}:null}function w(r){return o.sign({id:r.id,username:r.username},i,{expiresIn:"7d"})}function y(r){try{return o.verify(r,i)}catch{return null}}async function h(){const r=await t("SELECT COUNT(*) as count FROM admin_users");return parseInt(r.rows[0].count)>0}export{p as a,h as b,T as c,w as g,y as v};
