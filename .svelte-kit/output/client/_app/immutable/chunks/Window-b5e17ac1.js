import{S as le,i as ae,s as fe,X as b,F as re,l as N,w as ce,a as _e,m as D,n as V,x as he,h as T,c as ue,p as S,q as r,b as de,J as X,y as me,O as Y,a0 as ge,G as pe,H as we,I as be,f as F,t as G,B as xe,R as ze,P as J,o as ye,_ as M}from"./index-7043d62e.js";import{T as ke}from"./TitleBar-43a93d4a.js";import{u as We}from"./utils-1f7a3290.js";import"./lodash-b0811ec1.js";import{g as He,s as j}from"./index-e9763cd9.js";import{r as A,z as E}from"./store-a53f3f11.js";const Ce=n=>({}),K=n=>({});function Re(n){let t,s,d,m,x,y,W,i=`${n[0].width}px`,g=`${n[0].height}px`,l=`${n[0].min_width}px`,k=`${n[0].min_height}px`,h,p,H,q={options:n[0],inactive:n[4]<n[14],maximized:n[2],on_click_close:n[5],on_click_maximize:n[6],on_click_minimize:n[7]};d=new ke({props:q}),n[24](d);const C=n[23].content,c=re(C,n,n[22],K);return{c(){t=N("div"),s=N("div"),ce(d.$$.fragment),m=_e(),x=N("div"),c&&c.c(),this.h()},l(o){t=D(o,"DIV",{style:!0,"program-id":!0,class:!0});var f=V(t);s=D(f,"DIV",{class:!0});var u=V(s);he(d.$$.fragment,u),u.forEach(T),m=ue(f),x=D(f,"DIV",{class:!0});var B=V(x);c&&c.l(B),B.forEach(T),f.forEach(T),this.h()},h(){S(s,"class","shrink-0"),S(x,"class","grow shrink-0 relative shadow-xl"),r(t,"opacity","0"),r(t,"position","absolute"),r(t,"border-top-left-radius","8px"),r(t,"border-top-right-radius","8px"),r(t,"padding","0px"),r(t,"-webkit-font-smoothing","antialiased"),S(t,"program-id",y=n[0].id),S(t,"class",W="window absolute flex flex-col bg-xp-yellow "+(n[13]?"transition duration-300":"")+" "+(n[3]?"opacity-0":"")),r(t,"width",i,!1),r(t,"height",g,!1),r(t,"min-width",l,!1),r(t,"min-height",k,!1),r(t,"transform",n[3]?`${n[11]} ${n[12]} scale(0.1)`:"none",!1),r(t,"background",n[0].background,!1),r(t,"z-index",n[4],!1),r(t,"box-shadow",n[4]<n[14]?"var(--window-box-shadow-inactive)":"var(--window-box-shadow)",!1)},m(o,f){de(o,t,f),X(t,s),me(d,s,null),X(t,m),X(t,x),c&&c.m(x,null),n[25](t),h=!0,p||(H=[Y(t,"mousedown",n[8]),ge(n[15].call(null,t)),Y(t,"click_outside",n[9])],p=!0)},p(o,[f]){const u={};f&1&&(u.options=o[0]),f&16400&&(u.inactive=o[4]<o[14]),f&4&&(u.maximized=o[2]),f&32&&(u.on_click_close=o[5]),f&64&&(u.on_click_maximize=o[6]),f&128&&(u.on_click_minimize=o[7]),d.$set(u),c&&c.p&&(!h||f&4194304)&&pe(c,C,o,o[22],h?be(C,o[22],f,Ce):we(o[22]),K),(!h||f&1&&y!==(y=o[0].id))&&S(t,"program-id",y),(!h||f&8200&&W!==(W="window absolute flex flex-col bg-xp-yellow "+(o[13]?"transition duration-300":"")+" "+(o[3]?"opacity-0":"")))&&S(t,"class",W),f&1&&i!==(i=`${o[0].width}px`)&&r(t,"width",i,!1),f&1&&g!==(g=`${o[0].height}px`)&&r(t,"height",g,!1),f&1&&l!==(l=`${o[0].min_width}px`)&&r(t,"min-width",l,!1),f&1&&k!==(k=`${o[0].min_height}px`)&&r(t,"min-height",k,!1),f&6152&&r(t,"transform",o[3]?`${o[11]} ${o[12]} scale(0.1)`:"none",!1),f&1&&r(t,"background",o[0].background,!1),f&16&&r(t,"z-index",o[4],!1),f&16400&&r(t,"box-shadow",o[4]<o[14]?"var(--window-box-shadow-inactive)":"var(--window-box-shadow)",!1)},i(o){h||(F(d.$$.fragment,o),F(c,o),h=!0)},o(o){G(d.$$.fragment,o),G(c,o),h=!1},d(o){o&&T(t),n[24](null),xe(d),c&&c.d(o),n[25](null),p=!1,ze(H)}}}function U(n){return n==null?{x:document.body.offsetWidth*.5,y:document.body.offsetHeight*.5}:{x:n.x+n.width*.5,y:n.y+n.height*.5}}function Se(n,t,s){let d,m;J(n,A,e=>s(27,d=e)),J(n,E,e=>s(14,m=e));let{$$slots:x={},$$scope:y}=t;const{click_outside:W}=We;let{options:i={}}=t,g,{node_ref:l}=t,k,{maximized:h}=t,{minimized:p}=t,H="",q="",C=!1,{on_focused:c=()=>{}}=t,{z_index:o=0}=t;ye(async()=>{if(i.exec_path!=null){let e=await He(i.exec_path);if(e){e={top:e.top,left:e.left,width:e.width,height:e.height};let _=document.querySelector("#work-space"),a=v(e);e.top=e.top+a.top,e.left=e.left+a.left,e.left+e.width<=_.offsetWidth&&e.top+e.height<=_.offsetHeight&&(s(0,i.top=e.top,i),s(0,i.left=e.left,i),s(0,i.width=e.width,i),s(0,i.height=e.height,i))}}i.top==null&&s(0,i.top=(l.parentNode.offsetHeight-l.offsetHeight)/2,i),i.left==null&&s(0,i.left=(l.parentNode.offsetWidth-l.offsetWidth)/2,i),I({top:i.top,left:i.left,width:i.width,height:i.height}),i.resizable==null&&s(0,i.resizable=!0,i),i.draggable==null&&s(0,i.draggable=!0,i),$(),E.update(e=>e+1),s(4,o=m),l.style.removeProperty("opacity"),setTimeout(()=>{s(13,C=!0)},500)});let{on_click_close:f=()=>{}}=t,{on_click_maximize:u=()=>{!i.resizable||(s(3,p=!1),h?(I(k),s(2,h=!1)):(k={top:l.offsetTop,left:l.offsetLeft,width:l.offsetWidth,height:l.offsetHeight},I({top:0,left:0,width:l.parentNode.offsetWidth,height:l.parentNode.offsetHeight}),s(2,h=!0)),P())}}=t,{on_click_minimize:B=()=>{let e=U(l.getBoundingClientRect()),_=U(document.querySelector(`.program-tile[program-id="${i.id}"]`)?.getBoundingClientRect());s(11,H=`translateX(${_.x-e.x}px)`),s(12,q=`translateY(${_.y-e.y}px)`),console.log(`${H} ${q} scale(0.1)`),s(3,p=!0),L()}}=t;function Z(){p?s(3,p=!1):h&&u(),P()}function P(){o!=m&&(E.update(e=>e+1),s(4,o=m),c())}function L(){o==m&&(console.log("loose focus"),E.update(e=>e+1))}function v({top:e,left:_,width:a,height:R}){if(d.findLast(w=>w.options.id!=i.id&&w.options.exec_path==i.exec_path)==null)return{top:0,left:0};let z=10,se=[[z,z],[z,-z],[-z,z],[-z,-z],[0,0]],Q=document.querySelector("#work-space");for(let w of se)if(e+w[0]>=0&&_+w[1]>=0&&e+R+w[0]<=Q.offsetHeight&&_+a+w[1]<=Q.offsetWidth)return{top:w[0],left:w[1]};return{top:0,left:0}}function I({top:e,left:_,width:a,height:R}){s(1,l.style.top=`${e}px`,l),s(1,l.style.left=`${_}px`,l),s(1,l.style.width=`${a}px`,l),s(1,l.style.height=`${R}px`,l),i.exec_path&&j(i.exec_path,l.getBoundingClientRect())}function $(){i.draggable&&jQuery(l).draggable({containment:"parent",handle:".titlebar",stop:async()=>{i.exec_path&&await j(i.exec_path,l.getBoundingClientRect())}}),i.resizable&&jQuery(l).resizable({minWidth:i.min_width,minHeight:i.min_height,aspectRatio:i.aspect_ratio,containment:"parent",handles:"all",classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se opacity-0"},start:()=>{let e=l.querySelector("iframe");e&&(e.style.pointerEvents="none")},stop:async()=>{i.exec_path&&await j(i.exec_path,l.getBoundingClientRect());let e=l.querySelector("iframe");e&&e.style.removeProperty("pointer-events")}})}function ee(e){g.update_icon(e)}function te(e){A.update(_=>{let a=_.find(O=>O.options.id==i.id),R=_.indexOf(a);return R>=0&&(_[R].options.title=e),_}),g.update_title(e)}function ie({theme:e="dark",message:_}){let a=document.createElement("div");a.style.position="absolute",a.style.transform="translate(-50%)",a.style.left="50%",a.style.top="50%",a.style.padding="10px",a.innerText=_,a.style.borderRadius="7px",a.style.opacity=1,a.style.fontSize="12px",a.style.minHeight="30px",a.style.minWidth="70px",a.style.zIndex=99999,e=="dark"?(a.style.backgroundColor="#0f172a",a.style.border="1px solid #f1f5f9",a.style.color="#f8fafc"):(a.style.backgroundColor="#f1f5f9",a.style.border="1px solid #1e293b",a.style.color="#0f172a"),l.append(a),setTimeout(()=>{a.remove()},3e3)}function oe(e){M[e?"unshift":"push"](()=>{g=e,s(10,g)})}function ne(e){M[e?"unshift":"push"](()=>{l=e,s(1,l)})}return n.$$set=e=>{"options"in e&&s(0,i=e.options),"node_ref"in e&&s(1,l=e.node_ref),"maximized"in e&&s(2,h=e.maximized),"minimized"in e&&s(3,p=e.minimized),"on_focused"in e&&s(16,c=e.on_focused),"z_index"in e&&s(4,o=e.z_index),"on_click_close"in e&&s(5,f=e.on_click_close),"on_click_maximize"in e&&s(6,u=e.on_click_maximize),"on_click_minimize"in e&&s(7,B=e.on_click_minimize),"$$scope"in e&&s(22,y=e.$$scope)},[i,l,h,p,o,f,u,B,P,L,g,H,q,C,m,W,c,Z,I,ee,te,ie,y,x,oe,ne]}class Ne extends le{constructor(t){super(),ae(this,t,Se,Re,fe,{options:0,node_ref:1,maximized:2,minimized:3,on_focused:16,z_index:4,on_click_close:5,on_click_maximize:6,on_click_minimize:7,restore:17,focus:8,loose_focus:9,set_position:18,update_icon:19,update_title:20,show_toast:21})}get options(){return this.$$.ctx[0]}set options(t){this.$$set({options:t}),b()}get node_ref(){return this.$$.ctx[1]}set node_ref(t){this.$$set({node_ref:t}),b()}get maximized(){return this.$$.ctx[2]}set maximized(t){this.$$set({maximized:t}),b()}get minimized(){return this.$$.ctx[3]}set minimized(t){this.$$set({minimized:t}),b()}get on_focused(){return this.$$.ctx[16]}set on_focused(t){this.$$set({on_focused:t}),b()}get z_index(){return this.$$.ctx[4]}set z_index(t){this.$$set({z_index:t}),b()}get on_click_close(){return this.$$.ctx[5]}set on_click_close(t){this.$$set({on_click_close:t}),b()}get on_click_maximize(){return this.$$.ctx[6]}set on_click_maximize(t){this.$$set({on_click_maximize:t}),b()}get on_click_minimize(){return this.$$.ctx[7]}set on_click_minimize(t){this.$$set({on_click_minimize:t}),b()}get restore(){return this.$$.ctx[17]}get focus(){return this.$$.ctx[8]}get loose_focus(){return this.$$.ctx[9]}get set_position(){return this.$$.ctx[18]}get update_icon(){return this.$$.ctx[19]}get update_title(){return this.$$.ctx[20]}get show_toast(){return this.$$.ctx[21]}}export{Ne as W};
