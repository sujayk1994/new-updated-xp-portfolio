import{S as fe,i as de,s as pe,l as R,a as X,r as _e,m as q,n as A,h as v,c as j,u as me,p as y,q as E,b as N,J as x,O as w,E as W,R as Z,P as T,X as De,w as he,x as ge,a2 as Ee,y as be,a0 as Ie,a1 as Re,a8 as qe,d as ye,f as G,t as H,B as ke,a9 as O,o as Ae,g as ve,v as Be,aa as Me,_ as ze,D as Pe}from"../../chunks/index-59da92c8.js";import{h as F,a as L,c as J,e as ie,d as Ve,b as Ce}from"../../chunks/store-fabc0359.js";import{u as Ke,i as Fe,f as Le,g as Oe,h as Te}from"../../chunks/utils-1f7a3290.js";import{r as se,d as Xe,c as ae,i as re,e as je}from"../../chunks/system-e72d84b7.js";import{c as Je,a as Ge,p as He}from"../../chunks/fs-94169c0b.js";import"../../chunks/lodash-b0811ec1.js";import{D as Ne,p as Qe}from"../../chunks/dir_parser-92703b79.js";import{P as Ue}from"../../chunks/Previewable-21087848.js";import"../../chunks/index-5377a032.js";import"../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../chunks/index-355ed6be.js";import"../../chunks/finder-f715ee8c.js";import"../../chunks/admin-b2f51e94.js";function We(i){let e,t,s,l,r,p,u,m;return{c(){e=R("div"),t=R("div"),s=X(),l=R("p"),r=_e("Recycle Bin"),this.h()},l(c){e=q(c,"DIV",{class:!0,style:!0});var d=A(e);t=q(d,"DIV",{class:!0}),A(t).forEach(v),s=j(d),l=q(d,"P",{class:!0,style:!0});var h=A(l);r=me(h,"Recycle Bin"),h.forEach(v),d.forEach(v),this.h()},h(){y(t,"class","w-[40px] h-[40px] bg-contain"),E(t,"background-image",i[2],!1),y(l,"class","text-center text-[11px] font-MSSS text-white"),E(l,"text-shadow","1px 1px 2px black"),y(e,"class",p="flex flex-col items-center absolute bottom-2 right-2 "+i[1]),y(e,"style",i[0])},m(c,d){N(c,e,d),x(e,t),x(e,s),x(e,l),x(l,r),u||(m=[w(e,"dblclick",i[3]),w(e,"contextmenu",i[4])],u=!0)},p(c,[d]){d&4&&E(t,"background-image",c[2],!1),d&2&&p!==(p="flex flex-col items-center absolute bottom-2 right-2 "+c[1])&&y(e,"class",p),d&1&&y(e,"style",c[0])},i:W,o:W,d(c){c&&v(e),u=!1,Z(m)}}}function Ye(i,e,t){let s,l;T(i,F,c=>t(5,l=c));let{style:r}=e,{classes:p}=e;function u(){let c=l[se];L.set({path:"./programs/my_computer.svelte",fs_item:c})}function m(c){J.set(null),J.set({x:c.x,y:c.y,type:"RecycleBin",originator:null})}return i.$$set=c=>{"style"in c&&t(0,r=c.style),"classes"in c&&t(1,p=c.classes)},i.$$.update=()=>{i.$$.dirty&32&&t(2,s=l[se]?.children.length>0||l[se]?.children.length>0?"url(/images/xp/icons/RecycleBinfull.png)":"url(/images/xp/icons/RecycleBinempty.png)")},[r,p,s,u,m,l]}class Ze extends fe{constructor(e){super(),de(this,e,Ye,We,pe,{style:0,classes:1})}}function oe(i,e,t){const s=i.slice();return s[28]=e[t],s[30]=t,s}function $e(i){let e,t;return{c(){e=R("div"),this.h()},l(s){e=q(s,"DIV",{class:!0});var l=A(e);l.forEach(v),this.h()},h(){y(e,"class",t="w-[40px] h-[40px] shrink-0 bg-contain bg-no-repeat bg-center "+(i[5].includes(i[28].id)&&i[6]=="cut"?"opacity-70":"")+" "+(i[28].type=="folder"?"bg-[url(/images/xp/icons/FolderClosed.png)]":"bg-[url(/images/xp/icons/Default.png)]")),E(e,"background-image",i[15](i[28]),!1)},m(s,l){N(s,e,l)},p(s,l){l&104&&t!==(t="w-[40px] h-[40px] shrink-0 bg-contain bg-no-repeat bg-center "+(s[5].includes(s[28].id)&&s[6]=="cut"?"opacity-70":"")+" "+(s[28].type=="folder"?"bg-[url(/images/xp/icons/FolderClosed.png)]":"bg-[url(/images/xp/icons/Default.png)]"))&&y(e,"class",t),l&8&&E(e,"background-image",s[15](s[28]),!1)},i:W,o:W,d(s){s&&v(e)}}}function et(i){let e,t;return e=new Ue({props:{size:40,default_icon:i[15](i[28]),fs_id:i[28].id}}),{c(){he(e.$$.fragment)},l(s){ge(e.$$.fragment,s)},m(s,l){be(e,s,l),t=!0},p(s,l){const r={};l&8&&(r.default_icon=s[15](s[28])),l&8&&(r.fs_id=s[28].id),e.$set(r)},i(s){t||(G(e.$$.fragment,s),t=!0)},o(s){H(e.$$.fragment,s),t=!1},d(s){ke(e,s)}}}function ce(i){let e,t,s,l;function r(...u){return i[17](i[28],...u)}function p(...u){return i[18](i[28],...u)}return{c(){e=R("textarea"),this.h()},l(u){e=q(u,"TEXTAREA",{class:!0}),A(e).forEach(v),this.h()},h(){e.autofocus=!0,y(e,"class","absolute max-h-[40px] left-0 top-[40px] right-0 bottom-0 overflow-hidden outline-none border-1 border-slate-900 text-[11px] font-MSSS z-50 resize-none"),e.value=t=i[28].name},m(u,m){N(u,e,m),e.focus(),s||(l=[w(e,"keydown",r),w(e,"blur",p)],s=!0)},p(u,m){i=u,m&8&&t!==(t=i[28].name)&&(e.value=t)},d(u){u&&v(e),s=!1,Z(l)}}}function ue(i,e){let t,s,l,r,p,u,m=(e[28].executable?e[28].basename:e[28].name)+"",c,d,h,f=e[4].includes(e[28].id)&&e[0],o,b,B=`${Y}px`,$=`${Y}px`,I,z,Q;const C=[et,$e],S=[];function U(k,_){return _&8&&(s=null),s==null&&(s=!!je.includes(k[28].ext)),s?0:1}l=U(e,-1),r=S[l]=C[l](e);let g=f&&ce(e);function ee(){return e[19](e[28])}function te(...k){return e[20](e[28],...k)}return{key:i,first:null,c(){t=R("div"),r.c(),p=X(),u=R("p"),c=_e(m),h=X(),g&&g.c(),o=X(),this.h()},l(k){t=q(k,"DIV",{"fs-id":!0,class:!0});var _=A(t);r.l(_),p=j(_),u=q(_,"P",{class:!0,style:!0});var M=A(u);c=me(M,m),M.forEach(v),h=j(_),g&&g.l(_),o=j(_),_.forEach(v),this.h()},h(){y(u,"class",d="px-1 mx-0.5 text-[11px] break-words line-clamp-2 text-ellipsis leading-tight text-center text-white "+(e[4]?.includes(e[28].id)&&e[1]?"bg-blue-600 text-slate-50":"")),E(u,"text-shadow","1px 1px 2px black"),y(t,"fs-id",b=e[28].id),y(t,"class","relative fs-item w-[150px] flex-shrink-0 flex-grow-0 overflow-hidden m-2 inline-flex flex-col items-center font-MSSS"),E(t,"transform",e[28].desktop_css_transform,!1),E(t,"width",B,!1),E(t,"height",$,!1),this.first=t},m(k,_){N(k,t,_),S[l].m(t,null),x(t,p),x(t,u),x(u,c),x(t,h),g&&g.m(t,null),x(t,o),I=!0,z||(Q=[w(t,"dblclick",ee),w(t,"contextmenu",te)],z=!0)},p(k,_){e=k;let M=l;l=U(e,_),l===M?S[l].p(e,_):(ve(),H(S[M],1,1,()=>{S[M]=null}),ye(),r=S[l],r?r.p(e,_):(r=S[l]=C[l](e),r.c()),G(r,1),r.m(t,p)),(!I||_&8)&&m!==(m=(e[28].executable?e[28].basename:e[28].name)+"")&&Be(c,m),(!I||_&26&&d!==(d="px-1 mx-0.5 text-[11px] break-words line-clamp-2 text-ellipsis leading-tight text-center text-white "+(e[4]?.includes(e[28].id)&&e[1]?"bg-blue-600 text-slate-50":"")))&&y(u,"class",d),_&25&&(f=e[4].includes(e[28].id)&&e[0]),f?g?g.p(e,_):(g=ce(e),g.c(),g.m(t,o)):g&&(g.d(1),g=null),(!I||_&8&&b!==(b=e[28].id))&&y(t,"fs-id",b),_&8&&E(t,"transform",e[28].desktop_css_transform,!1)},i(k){I||(G(r),I=!0)},o(k){H(r),I=!1},d(k){k&&v(t),S[l].d(),g&&g.d(),z=!1,Z(Q)}}}function tt(i){let e,t,s=[],l=new Map,r,p,u,m,c,d=i[3];const h=f=>f[28].id;for(let f=0;f<d.length;f+=1){let o=oe(i,d,f),b=h(o);l.set(b,s[f]=ue(b,o))}return p=new Ze({props:{style:"width: "+Y+"px;height: "+Y+"px;"}}),{c(){e=R("div"),t=R("div");for(let f=0;f<s.length;f+=1)s[f].c();r=X(),he(p.$$.fragment),this.h()},l(f){e=q(f,"DIV",{class:!0});var o=A(e);t=q(o,"DIV",{class:!0});var b=A(t);for(let B=0;B<s.length;B+=1)s[B].l(b);b.forEach(v),r=j(o),ge(p.$$.fragment,o),o.forEach(v),this.h()},h(){y(t,"class","top-0 left-0 bottom-0 absolute flex flex-col flex-wrap"),Ee(t,"hidden",i[8]==null),y(e,"class","absolute z-0 inset-0 overflow-hidden bg-transparent")},m(f,o){N(f,e,o),x(e,t);for(let b=0;b<s.length;b+=1)s[b].m(t,null);x(e,r),be(p,e,null),i[23](e),u=!0,m||(c=[w(window,"keydown",i[13]),w(e,"drop",i[14]),w(e,"dragover",lt),w(e,"click",i[21]),Ie(i[7].call(null,e)),w(e,"click_outside",i[22]),w(e,"contextmenu",Re(i[10]))],m=!0)},p(f,[o]){o&39547&&(d=f[3],ve(),s=qe(s,o,h,1,f,d,l,t,Me,ue,null,oe),ye())},i(f){if(!u){for(let o=0;o<d.length;o+=1)G(s[o]);G(p.$$.fragment,f),u=!0}},o(f){for(let o=0;o<s.length;o+=1)H(s[o]);H(p.$$.fragment,f),u=!1},d(f){f&&v(e);for(let o=0;o<s.length;o+=1)s[o].d();ke(p),i[23](null),m=!1,Z(c)}}}let Y=80;function lt(i){i.preventDefault()}function st(i,e,t){let s,l,r,p,u;T(i,F,n=>t(16,l=n)),T(i,ie,n=>t(4,r=n)),T(i,Ve,n=>t(5,p=n)),T(i,Ce,n=>t(6,u=n));const{click_outside:m}=Ke;let c=Xe,d=!0,h,{renaming:f=!1}=e;const o=new Ne({customStyles:!1,draggability:!0});o.subscribe("callback",n=>{for(let a of n.items){let D=a.getAttribute("fs-id");D!=null&&l[D]!=null&&(Fe(a.style.transform)||O(F,l[D].desktop_css_transform=a.style.transform,l))}O(ie,r=n.items.map(a=>a.getAttribute("fs-id")).filter(a=>l[a]!=null),r),console.log(r.map(a=>l[a]))});const b=new MutationObserver(n=>{o.setSettings({selectables:h?h.querySelectorAll(".fs-item"):[]})});Ae(async()=>{o.setSettings({selectables:h.querySelectorAll(".fs-item"),area:h}),b.observe(h,{attributes:!1,childList:!0,characterData:!1,subtree:!0})});function B(n,a){let D=r.includes(a.id),P=h.querySelector(`.fs-item[fs-id="${a.id}"]`);!D&&P&&P.classList.contains("fs-item")&&(n.metaKey||n.ctrlKey?o.addSelection([P],!0):o.setSelection([P],!0)),J.set(null);let K={item:a};K.open=V=>{z(V)},K.rename=()=>{Q()},J.set({x:n.x,y:n.y,type:"FSItem",originator:K})}function $(n){let a={id:c};J.set({x:n.x,y:n.y,type:"Desktop",originator:a})}function I(){console.log("clear_selection"),o.clearSelection(!0)}function z(n){t(1,d=!1),I();let a=l[n];a.type=="file"?a.executable?L.set({path:a.url,webapp:a.webapp}):ae[a.ext]!=null?L.set({path:ae[a.ext][0].path,fs_item:a}):L.set({path:"./programs/notepad.svelte",fs_item:a}):L.set({path:"./programs/my_computer.svelte",fs_item:a})}function Q(){t(0,f=!0),Pe().then(()=>{let n=r[0],a=document.querySelector(`div[fs-id="${n}"] textarea`),D=l[n].basename.length;a?.setSelectionRange(0,D)})}function C(n,a){let D=Le(n.target.value),P=Oe(D),K=Te(D,P),V=K;if(a.ext=P.toLowerCase(),V.trim()==""){t(0,f=!1);return}let Se=[...l[a.parent].children.filter(le=>le!=a.id).map(le=>l[le].name)],ne=2;for(;Se.includes(V+a.ext);)V=K+" "+ne,ne++;O(F,l[a.id].basename=V,l),O(F,l[a.id].ext=a.ext,l),O(F,l[a.id].name=V+a.ext,l),t(0,f=!1)}function S(n){if(!!d&&!f&&(console.log("keyevent in desktop_folder"),!!(n.ctrlKey||n.metaKey))){if(n.key=="c")Je();else if(n.key=="x")Ge();else if(n.key=="v")He(c);else if(n.key=="a"){let a=h.querySelectorAll(".fs-item");o.setSelection(a,!0)}}}async function U(n){n.preventDefault();let a=await Qe(n);L.set({path:"./programs/copier.svelte",copying_obj:a,target_folder_id:c})}function g(n){return n.icon!=null?`url(${n.icon})`:re[n.ext]!=null?`url(/images/xp/icons/${re[n.ext]})`:null}const ee=(n,a)=>a.key=="Enter"&&C(a,n),te=(n,a)=>C(a,n),k=n=>z(n.id),_=(n,a)=>B(a,n),M=()=>t(1,d=!0),we=()=>{t(1,d=!1)};function xe(n){ze[n?"unshift":"push"](()=>{h=n,t(2,h)})}return i.$$set=n=>{"renaming"in n&&t(0,f=n.renaming)},i.$$.update=()=>{i.$$.dirty&65536&&t(3,s=l[c]==null?[]:l[c].children.map(n=>l[n]).filter(n=>n!=null))},[f,d,h,s,r,p,u,m,c,B,$,z,C,S,U,g,l,ee,te,k,_,M,we,xe]}class gt extends fe{constructor(e){super(),de(this,e,st,tt,pe,{renaming:0})}get renaming(){return this.$$.ctx[0]}set renaming(e){this.$$set({renaming:e}),De()}}export{gt as default};
