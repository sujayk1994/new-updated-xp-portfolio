import{_ as M}from"../../../chunks/preload-helper-c28b9807.js";import{S as K,i as Q,X as m,s as Y,w as R,x as S,y as V,f as g,t as x,B as q,P as E,l as D,a as Z,m as v,n as k,c as $,h as y,N as ee,p as u,b as O,J as I,O as te,g as ie,d as ne,_ as N}from"../../../chunks/index-7043d62e.js";import{W as se}from"../../../chunks/Window-b5e17ac1.js";import{h as oe,z as ae,r as re}from"../../../chunks/store-a53f3f11.js";import{j as le}from"../../../chunks/utils-1f7a3290.js";import{d as z,f as fe,s as ce,e as _e}from"../../../chunks/fs-359b7395.js";import{D as de}from"../../../chunks/DumbProgress-474c7fb6.js";import"../../../chunks/TitleBar-43a93d4a.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-e9763cd9.js";import"../../../chunks/index-bc59e2a0.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-63196e92.js";import"../../../chunks/admin-093cca4c.js";import"../../../chunks/ProgressBar-faa0e4b3.js";function A(r){let e,i,o;return i=new de({props:{style:"width:150px;height:15px;"}}),{c(){e=D("div"),R(i.$$.fragment),this.h()},l(s){e=v(s,"DIV",{class:!0});var l=k(e);S(i.$$.fragment,l),l.forEach(y),this.h()},h(){u(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,l){O(s,e,l),V(i,e,null),o=!0},i(s){o||(g(i.$$.fragment,s),o=!0)},o(s){x(i.$$.fragment,s),o=!1},d(s){s&&y(e),q(i)}}}function ue(r){let e,i,o,s,l,a,f,p,n=!r[4]&&A();return{c(){e=D("div"),n&&n.c(),i=Z(),o=D("iframe"),this.h()},l(c){e=v(c,"DIV",{slot:!0,class:!0});var _=k(e);n&&n.l(_),i=$(_),o=v(_,"IFRAME",{src:!0,width:!0,height:!0,class:!0});var d=k(o);d.forEach(y),_.forEach(y),this.h()},h(){ee(o.src,s="/html/foxit_reader/web/viewer.html")||u(o,"src",s),u(o,"width","100%"),u(o,"height","100%"),u(o,"class",l="inset-0 absolute bg-black "+(r[4]?"":"opacity-0")+" "+(r[0]?.z_index==r[5]?"pointer-events-auto":"pointer-events-none")),u(e,"slot","content"),u(e,"class","absolute inset-1 top-0 flex flex-col bg-slate-50")},m(c,_){O(c,e,_),n&&n.m(e,null),I(e,i),I(e,o),r[12](o),a=!0,f||(p=te(o,"load",r[6]),f=!0)},p(c,_){c[4]?n&&(ie(),x(n,1,1,()=>{n=null}),ne()):n?_&16&&g(n,1):(n=A(),n.c(),g(n,1),n.m(e,i)),(!a||_&49&&l!==(l="inset-0 absolute bg-black "+(c[4]?"":"opacity-0")+" "+(c[0]?.z_index==c[5]?"pointer-events-auto":"pointer-events-none")))&&u(o,"class",l)},i(c){a||(g(n),a=!0)},o(c){x(n),a=!1},d(c){c&&y(e),n&&n.d(),r[12](null),f=!1,p()}}}function me(r){let e,i,o={options:r[2],on_click_close:r[1],$$slots:{content:[ue]},$$scope:{ctx:r}};return e=new se({props:o}),r[13](e),{c(){R(e.$$.fragment)},l(s){S(e.$$.fragment,s)},m(s,l){V(e,s,l),i=!0},p(s,[l]){const a={};l&4&&(a.options=s[2]),l&524345&&(a.$$scope={dirty:l,ctx:s}),e.$set(a)},i(s){i||(g(e.$$.fragment,s),i=!0)},o(s){x(e.$$.fragment,s),i=!1},d(s){r[13](null),q(e,s)}}}async function pe({node_ref:r,filetypes_desc:e,filetypes:i}){return new Promise(async(o,s)=>{const l=(await M(()=>import("../../../chunks/OpenModal-c8aab4f0.js"),["_app/immutable/chunks/OpenModal-c8aab4f0.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let a=new l({target:r,props:{filetypes:i,filetypes_desc:e}});a.self=a,a.on_open=()=>{o(a.selected_items),a.destroy()}})}async function he({node_ref:r,filetypes:e,id:i,current_filetype:o}){return new Promise(async(s,l)=>{const a=(await M(()=>import("../../../chunks/SaveModal-8f801486.js"),["_app/immutable/chunks/SaveModal-8f801486.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let f=new a({target:r,props:{filetypes:e,selected_filetype:o,id:i}});f.self=f,f.on_save=()=>{s({parent_id:f.parent_id,filename:f.filename,selected_filetype:f.selected_filetype}),f.destroy()}})}function we(r,e,i){let o,s;E(r,oe,t=>i(15,o=t)),E(r,ae,t=>i(5,s=t));let{id:l}=e,{window:a}=e,{self:f}=e,{parentNode:p}=e,{fs_item:n}=e,{exec_path:c}=e,_=[{name:"Adobe Portable Document Format",mime:"application/pdf",ext:".pdf"}];_=_.map(t=>(t.name=t.name+" ("+t.ext+")",t));let d,P=!1;async function j(){re.update(t=>t.filter(h=>h!=f)),f.$destroy()}let b={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:W={title:n==null?"Foxit Reader":n.name,min_width:500,min_height:400,width:Math.min(b.width-20,(b.height-20)*1.6),height:Math.min(b.height-20),icon:"/images/xp/icons/FoxitReader.png",id:l,exec_path:c}}=e;async function L(){let t=await pe({node_ref:a.node_ref,filetypes_desc:"Adobe Portable Document Format",filetypes:_.map(w=>w.ext)});i(7,n=o[t[0]]);let h=await z(t[0]);return console.log({fs_item:n}),h}async function T(){console.log(n);let t=_.find(G=>G.ext==n?.ext);t==null&&(t=_[0]);let{parent_id:h,filename:w,selected_filetype:J}=await he({id:n?.parent,node_ref:a.node_ref,filetypes:_,current_filetype:t}),U=await d.contentWindow.PDFViewerApplication.pdfDocument.saveDocument(),X=new File([U],w,{type:le(w)}),F=ce.generate();await _e(w,J.ext,X,h,F),i(7,n=o[F])}async function B(){if(d.contentWindow.setup_ui(),n!=null){let t=await z(n.id);d.contentWindow.open(t)}else{let t=await fe("/files/FoxitReader30_Manual.pdf");d.contentWindow.open(t)}i(3,d.contentWindow.open_file_func=async()=>{let t=await L();d.contentWindow.open(t)},d),i(3,d.contentWindow.save_file_as_func=async()=>{await T()},d),i(4,P=!0)}function C(t){N[t?"unshift":"push"](()=>{d=t,i(3,d)})}function H(t){N[t?"unshift":"push"](()=>{a=t,i(0,a)})}return r.$$set=t=>{"id"in t&&i(8,l=t.id),"window"in t&&i(0,a=t.window),"self"in t&&i(9,f=t.self),"parentNode"in t&&i(10,p=t.parentNode),"fs_item"in t&&i(7,n=t.fs_item),"exec_path"in t&&i(11,c=t.exec_path),"options"in t&&i(2,W=t.options)},r.$$.update=()=>{r.$$.dirty&129&&n&&a&&a.update_title(n.name)},[a,j,W,d,P,s,B,n,l,f,p,c,C,H]}class Re extends K{constructor(e){super(),Q(this,e,we,me,Y,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),m()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),m()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),m()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),m()}get fs_item(){return this.$$.ctx[7]}set fs_item(e){this.$$set({fs_item:e}),m()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),m()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),m()}}export{Re as default};
