import{_ as M}from"../../../chunks/preload-helper-c28b9807.js";import{S as X,i as G,X as m,s as Q,w as V,x as F,y as O,f as y,t as v,B as R,P as I,l as b,a as Y,m as x,n as k,c as Z,h as g,N as $,p as h,b as A,J as P,O as ee,g as te,d as oe,_ as N}from"../../../chunks/index-7043d62e.js";import{W as ne}from"../../../chunks/Window-b5e17ac1.js";import{h as ie,z as se,r as re,a as ae}from"../../../chunks/store-a53f3f11.js";import{d as S,s as le,e as fe}from"../../../chunks/fs-359b7395.js";import{D as ce}from"../../../chunks/DumbProgress-474c7fb6.js";import"../../../chunks/TitleBar-43a93d4a.js";import"../../../chunks/utils-1f7a3290.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-e9763cd9.js";import"../../../chunks/index-bc59e2a0.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-63196e92.js";import"../../../chunks/admin-093cca4c.js";import"../../../chunks/ProgressBar-faa0e4b3.js";function q(s){let e,t,f;return t=new ce({props:{style:"width:150px;height:15px;"}}),{c(){e=b("div"),V(t.$$.fragment),this.h()},l(o){e=x(o,"DIV",{class:!0});var l=k(e);F(t.$$.fragment,l),l.forEach(g),this.h()},h(){h(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(o,l){A(o,e,l),O(t,e,null),f=!0},i(o){f||(y(t.$$.fragment,o),f=!0)},o(o){v(t.$$.fragment,o),f=!1},d(o){o&&g(e),R(t)}}}function _e(s){let e,t,f,o,l,r,c,p,_,a=!s[4]&&q();return{c(){e=b("div"),t=b("div"),a&&a.c(),f=Y(),o=b("iframe"),this.h()},l(i){e=x(i,"DIV",{slot:!0,class:!0});var d=k(e);t=x(d,"DIV",{class:!0});var w=k(t);a&&a.l(w),f=Z(w),o=x(w,"IFRAME",{src:!0,class:!0}),k(o).forEach(g),w.forEach(g),d.forEach(g),this.h()},h(){$(o.src,l="/html/koodo/index.html")||h(o,"src",l),h(o,"class",r="w-full h-full "+(s[4]?"":"opacity-0")+" "+(s[0]?.z_index==s[5]?"pointer-events-auto":"pointer-events-none")),h(t,"class","absolute inset-0 overflow-auto bg-slate-100 font-sans"),h(e,"slot","content"),h(e,"class","absolute inset-0 flex flex-col bg-slate-800")},m(i,d){A(i,e,d),P(e,t),a&&a.m(t,null),P(t,f),P(t,o),s[13](o),c=!0,p||(_=ee(o,"load",s[6]),p=!0)},p(i,d){i[4]?a&&(te(),v(a,1,1,()=>{a=null}),oe()):a?d&16&&y(a,1):(a=q(),a.c(),y(a,1),a.m(t,f)),(!c||d&49&&r!==(r="w-full h-full "+(i[4]?"":"opacity-0")+" "+(i[0]?.z_index==i[5]?"pointer-events-auto":"pointer-events-none")))&&h(o,"class",r)},i(i){c||(y(a),c=!0)},o(i){v(a),c=!1},d(i){i&&g(e),a&&a.d(),s[13](null),p=!1,_()}}}function de(s){let e,t,f={options:s[2],on_click_close:s[1],on_focused:s[7],$$slots:{content:[_e]},$$scope:{ctx:s}};return e=new ne({props:f}),s[14](e),{c(){V(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,l){O(e,o,l),t=!0},p(o,[l]){const r={};l&4&&(r.options=o[2]),l&524345&&(r.$$scope={dirty:l,ctx:o}),e.$set(r)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){v(e.$$.fragment,o),t=!1},d(o){s[14](null),R(e,o)}}}async function ue({node_ref:s,filetypes_desc:e,filetypes:t}){return new Promise(async(f,o)=>{const l=(await M(()=>import("../../../chunks/OpenModal-c8aab4f0.js"),["_app/immutable/chunks/OpenModal-c8aab4f0.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let r=new l({target:s,props:{filetypes:t,filetypes_desc:e}});r.self=r,r.on_open=()=>{f(r.selected_items),r.destroy()}})}async function me({node_ref:s,filetypes:e,id:t,current_filetype:f}){return new Promise(async(o,l)=>{const r=(await M(()=>import("../../../chunks/SaveModal-8f801486.js"),["_app/immutable/chunks/SaveModal-8f801486.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let c=new r({target:s,props:{filetypes:e,selected_filetype:f,id:t}});c.self=c,c.on_save=()=>{o({parent_id:c.parent_id,filename:c.filename,selected_filetype:c.selected_filetype}),c.destroy()}})}function he(s,e,t){let f,o;I(s,ie,n=>t(15,f=n)),I(s,se,n=>t(5,o=n));let{id:l}=e,{window:r}=e,{self:c}=e,{parentNode:p}=e,{fs_item:_}=e,{exec_path:a}=e,i,d=!1;async function w(){re.update(n=>n.filter(u=>u!=c)),c.$destroy()}let D={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:z={title:"Koodo Reader",min_width:500,min_height:400,width:Math.min(D.width-20,(D.height-20)*1.6),height:Math.min(D.height-20),icon:"/images/xp/icons/Koodo.png",id:l,exec_path:a}}=e;async function K({filetypes_desc:n,filetypes:u}){let W=await ue({node_ref:r.node_ref,filetypes_desc:n,filetypes:u});return f[W[0]]}async function T(n){console.log(_);let u=[{name:"Document Format",ext:".epub"}],{parent_id:W,filename:E,selected_filetype:H}=await me({id:_?.parent,node_ref:r.node_ref,filetypes:u}),J=new File([n],E),U=le.generate();await fe(E,H.ext,J,W,U)}async function j(){if(_){console.log(_);let n=await S(_.id);i.contentWindow.import_book(n)}t(3,i.contentWindow.on_import_click=async()=>{let n=await K({filetypes_desc:"Supported Formats",filetypes:[".epub",".mobi",".pdf",".docx",".html",".azw3",".txt",".fb2",".cbr",".cbz",".cbt",".md",".rtf",".xml",".xhtml",".htm"]}),u=await S(n.id);i.contentWindow.import_book(u)},i),t(3,i.contentWindow.open_url=n=>{ae.set({path:"./programs/internet_explorer.svelte",fs_item:{url:n}})},i),t(3,i.contentWindow.export_book=async n=>{await T(n)},i),t(4,d=!0),i.contentWindow.focus()}function L(){console.log("koodo:on_window_focused"),setTimeout(()=>{i&&i.contentWindow.focus()},500)}function B(n){N[n?"unshift":"push"](()=>{i=n,t(3,i)})}function C(n){N[n?"unshift":"push"](()=>{r=n,t(0,r)})}return s.$$set=n=>{"id"in n&&t(8,l=n.id),"window"in n&&t(0,r=n.window),"self"in n&&t(9,c=n.self),"parentNode"in n&&t(10,p=n.parentNode),"fs_item"in n&&t(11,_=n.fs_item),"exec_path"in n&&t(12,a=n.exec_path),"options"in n&&t(2,z=n.options)},[r,w,z,i,d,o,j,L,l,c,p,_,a,B,C]}class qe extends X{constructor(e){super(),G(this,e,he,de,Q,{id:8,window:0,self:9,parentNode:10,fs_item:11,exec_path:12,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),m()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),m()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),m()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),m()}get fs_item(){return this.$$.ctx[11]}set fs_item(e){this.$$set({fs_item:e}),m()}get exec_path(){return this.$$.ctx[12]}set exec_path(e){this.$$set({exec_path:e}),m()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),m()}}export{qe as default};
