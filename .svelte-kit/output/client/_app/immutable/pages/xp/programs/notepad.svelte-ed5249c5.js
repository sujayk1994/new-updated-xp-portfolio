import{_ as P}from"../../../chunks/preload-helper-c28b9807.js";import{S as se,i as ae,X as p,s as re,w as L,x as H,y as J,O as K,f as U,t as X,B as G,P as O,W as le,l as k,a as ce,m as D,n as N,c as de,h as y,N as fe,p as h,q as R,b as me,J as E,_ as q}from"../../../chunks/index-7043d62e.js";import{W as _e}from"../../../chunks/Window-b5e17ac1.js";import{z as ue,h as pe,a as S,r as we}from"../../../chunks/store-a53f3f11.js";import{j as z}from"../../../chunks/utils-1f7a3290.js";import{M as he}from"../../../chunks/Menu-efd686a8.js";import{d as C,j as ge,s as ye,e as xe}from"../../../chunks/fs-359b7395.js";import"../../../chunks/TitleBar-43a93d4a.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-e9763cd9.js";import"../../../chunks/index-bc59e2a0.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-63196e92.js";import"../../../chunks/admin-093cca4c.js";const{window:We}=le;function ve(s){let t,n,d,c,l,i,a,f,r;return n=new he({props:{menu:s[5]}}),{c(){t=k("div"),L(n.$$.fragment),d=ce(),c=k("div"),l=k("iframe"),this.h()},l(m){t=D(m,"DIV",{slot:!0,class:!0});var o=N(t);H(n.$$.fragment,o),d=de(o),c=D(o,"DIV",{class:!0});var g=N(c);l=D(g,"IFRAME",{src:!0,class:!0,style:!0,frameborder:!0}),N(l).forEach(y),g.forEach(y),o.forEach(y),this.h()},h(){fe(l.src,i="/html/notepad/index.html")||h(l,"src",i),h(l,"class","w-full h-full"),R(l,"visibility",s[4]?"visible":"hidden"),h(l,"frameborder","0"),h(c,"class","absolute inset-0 top-[25px] overflow-auto bg-slate-50 font-sans"),h(t,"slot","content"),h(t,"class","absolute inset-1 top-0 flex flex-col bg-xp-yellow")},m(m,o){me(m,t,o),J(n,t,null),E(t,d),E(t,c),E(c,l),s[15](l),a=!0,f||(r=K(l,"load",s[6]),f=!0)},p(m,o){(!a||o&16)&&R(l,"visibility",m[4]?"visible":"hidden")},i(m){a||(U(n.$$.fragment,m),a=!0)},o(m){X(n.$$.fragment,m),a=!1},d(m){m&&y(t),G(n),s[15](null),f=!1,r()}}}function be(s){let t,n,d,c,l={options:s[1],on_click_close:s[2],on_focused:s[8],$$slots:{content:[ve]},$$scope:{ctx:s}};return t=new _e({props:l}),s[16](t),{c(){L(t.$$.fragment)},l(i){H(t.$$.fragment,i)},m(i,a){J(t,i,a),n=!0,d||(c=K(We,"keydown",s[7]),d=!0)},p(i,[a]){const f={};a&2&&(f.options=i[1]),a&33554456&&(f.$$scope={dirty:a,ctx:i}),t.$set(f)},i(i){n||(U(t.$$.fragment,i),n=!0)},o(i){X(t.$$.fragment,i),n=!1},d(i){s[16](null),G(t,i),d=!1,c()}}}let B="Notepad";async function ke({node_ref:s,filetypes_desc:t,filetypes:n}){return new Promise(async(d,c)=>{const l=(await P(()=>import("../../../chunks/OpenModal-c8aab4f0.js"),["_app/immutable/chunks/OpenModal-c8aab4f0.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let i=new l({target:s,props:{filetypes:n,filetypes_desc:t}});i.self=i,i.on_open=()=>{d(i.selected_items),i.destroy()}})}async function De({node_ref:s,filetypes:t,id:n,current_filetype:d}){return new Promise(async(c,l)=>{const i=(await P(()=>import("../../../chunks/SaveModal-8f801486.js"),["_app/immutable/chunks/SaveModal-8f801486.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let a=new i({target:s,props:{filetypes:t,selected_filetype:d,id:n}});a.self=a,a.on_save=()=>{c({parent_id:a.parent_id,filename:a.filename,selected_filetype:a.selected_filetype}),a.destroy()}})}async function Ne({node_ref:s,title:t,message:n,icon:d,yes_action:c,no_action:l}){const i=(await P(()=>import("../../../chunks/Dialog-65840ec6.js"),["_app/immutable/chunks/Dialog-65840ec6.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/Button-4430907d.js"])).default;let a=[{name:"Save",action:()=>{c(),f.destroy()},focus:!0},{name:"Don't Save",action:()=>{l(),f.destroy()}},{name:"Cancel",action:()=>{f.destroy()}}],f=new i({target:s,props:{icon:d,title:t,message:n,buttons:a,button_align:"center"}});f.self=f}function Ee(s,t,n){let d,c;O(s,ue,e=>n(17,d=e)),O(s,pe,e=>n(18,c=e));let{id:l}=t,{window:i}=t,{self:a}=t,{parentNode:f}=t,{fs_item:r}=t,{exec_path:m}=t,o,g=!1,u=!1,{options:I={title:B,min_width:300,min_height:200,width:600,height:500,icon:"/images/xp/icons/Notepad.png",id:l,exec_path:m}}=t,Q=[{name:"File",items:[[{name:"Open",action:T}],[{name:"Save",action:v},{name:"Save As",action:F}],[{name:"Exit",action:A}]]},{name:"Edit",items:[[{name:"Undo",action:()=>o.contentWindow.undo()},{name:"Redo",action:()=>o.contentWindow.redo()}],[{name:"Find",action:()=>o.contentWindow.find()},{name:"Replace",action:()=>o.contentWindow.replace()}],[{name:"Date/Time",action:()=>o.contentWindow.insert(new Date().toDateString())}]]},{name:"Format",items:[[{name:"Word Wrap",action:()=>o.contentWindow.toggle_wrap()}]]},{name:"View",items:[[{name:"Status Bar"}]]},{name:"Help",items:[[{name:"Help Topics",action:()=>{S.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}},{name:"About Notepad",action:()=>{S.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://en.wikipedia.org/wiki/Windows_Notepad"}})}}]]}],x=[{name:"Plain Text (.txt)",ext:".txt"},{name:"Web Page (.html)",ext:".html"},{name:"Markdown (.md)",ext:".md"},{name:"Javascript (.js)",ext:".js"},{name:"VBScript (.vbs)",ext:".vbs"}];async function T(){let e=await Y({filetypes_desc:"All Files",filetypes:[]});if(r||u)S.set({path:"./programs/notepad.svelte",fs_item:e});else{n(9,r=e);let w=await(await C(r.id)).text();o.contentWindow.set_content(w),o.contentWindow.set_mode(r.name)}}async function A(){if(u){let e=()=>{W()},_=async()=>{await v(),W()};Ne({node_ref:i.node_ref,title:"Save Changes",message:"Do you want to save the changes you've made before closing this document?",yes_action:_,no_action:e})}else W()}function W(){we.update(e=>e.filter(_=>_!=a)),a.$destroy()}async function Y({filetypes_desc:e,filetypes:_}){let w=await ke({node_ref:i.node_ref,filetypes_desc:e,filetypes:_});return c[w[0]]}async function v(){if(r!=null){let e=o.contentWindow.get_content(),_=new File([e],r.name,{type:z(r.ext)});ge(r.id,_),o.contentWindow.set_mode(r.name),i.show_toast({message:"Changes Saved!",theme:"light"})}else await F();o.contentWindow.set_clean(),n(14,u=!1)}async function F(){console.log(r);let e=x.find(oe=>oe.ext==r?.ext);e==null&&(e=x[0]);let{parent_id:_,filename:w,selected_filetype:b}=await De({id:r?.parent,node_ref:i.node_ref,filetypes:x,current_filetype:e}),ne=z(b.ext),ie=o.contentWindow.get_content(),j=new File([ie],w,{type:ne});console.log(j);let M=ye.generate();await xe(w,b.ext,j,_,M),r==null&&n(9,r=c[M])}async function Z(){if(console.log(o),r){let _=await(await C(r.id)).text();o.contentWindow.set_content(_),o.contentWindow.set_mode(r.name)}else o.contentWindow.set_content("");n(3,o.contentWindow.dirty_state_changed=()=>{n(14,u=o.contentWindow.is_dirty()),console.log({dirty:u})},o),n(3,o.contentWindow.editor_clicked=()=>{i.focus()},o),n(3,o.contentWindow.parent_key_event=V,o),n(4,g=!0),setTimeout(()=>{o.contentWindow.editor.focus()},500)}function V(e){i.z_index==d&&(!(e.ctrlKey||e.metaKey)||(console.log("keyevent receive in notepad"),e.key=="s"?(e.preventDefault(),v()):e.key=="o"&&(e.preventDefault(),T())))}function $(){setTimeout(()=>{o&&o.contentWindow.editor.focus()},500)}function ee(e){q[e?"unshift":"push"](()=>{o=e,n(3,o)})}function te(e){q[e?"unshift":"push"](()=>{i=e,n(0,i)})}return s.$$set=e=>{"id"in e&&n(10,l=e.id),"window"in e&&n(0,i=e.window),"self"in e&&n(11,a=e.self),"parentNode"in e&&n(12,f=e.parentNode),"fs_item"in e&&n(9,r=e.fs_item),"exec_path"in e&&n(13,m=e.exec_path),"options"in e&&n(1,I=e.options)},s.$$.update=()=>{if(s.$$.dirty&16897){let e="";r?e=r.name:e=B,u&&(e+=" *"),i&&i.update_title(e)}},[i,I,A,o,g,Q,Z,V,$,r,l,a,f,m,u,ee,te]}class Le extends se{constructor(t){super(),ae(this,t,Ee,be,re,{id:10,window:0,self:11,parentNode:12,fs_item:9,exec_path:13,options:1,destroy:2})}get id(){return this.$$.ctx[10]}set id(t){this.$$set({id:t}),p()}get window(){return this.$$.ctx[0]}set window(t){this.$$set({window:t}),p()}get self(){return this.$$.ctx[11]}set self(t){this.$$set({self:t}),p()}get parentNode(){return this.$$.ctx[12]}set parentNode(t){this.$$set({parentNode:t}),p()}get fs_item(){return this.$$.ctx[9]}set fs_item(t){this.$$set({fs_item:t}),p()}get exec_path(){return this.$$.ctx[13]}set exec_path(t){this.$$set({exec_path:t}),p()}get options(){return this.$$.ctx[1]}set options(t){this.$$set({options:t}),p()}get destroy(){return this.$$.ctx[2]}}export{Le as default};
