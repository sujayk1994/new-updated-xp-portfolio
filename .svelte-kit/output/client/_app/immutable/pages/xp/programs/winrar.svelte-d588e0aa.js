import{S as se,i as ne,X as D,s as ie,w as M,x as A,y as L,f as v,t as P,B as j,o as re,l as k,a as R,m as x,n as N,c as T,h as E,p as y,b as Y,J as w,g as B,d as K,_ as le,r as O,u as C,N as ae,v as ee,Q as X,O as q,R as oe}from"../../../chunks/index-59da92c8.js";import{W as ce}from"../../../chunks/Window-6d40284c.js";import{B as V}from"../../../chunks/Button-5a8d2150.js";import{r as fe}from"../../../chunks/store-fabc0359.js";import{j as ue,h as pe,g as G}from"../../../chunks/utils-1f7a3290.js";import{d as J,b as Q}from"../../../chunks/fs-94169c0b.js";import{D as _e}from"../../../chunks/DumbProgress-ba1b12c7.js";import"../../../chunks/TitleBar-a503be9c.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";/* empty css                                                           */import"../../../chunks/index-5377a032.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-f715ee8c.js";import"../../../chunks/admin-b2f51e94.js";import"../../../chunks/ProgressBar-a36ef5c0.js";class W{constructor(e,t,n,s){this._name=e,this._size=t,this._path=n,this._archiveRef=s}get name(){return this._name}get size(){return this._size}extract(){return this._archiveRef.extractSingleFile(this._path)}}class ${static init(e={}){return $._options={workerUrl:"../dist/worker-bundle.js",...e},$._options}static open(e,t=null){return t=t||$._options||$.init()&&console.warn("Automatically initializing using options: ",$._options),new $(e,t).open()}constructor(e,t){this._worker=new Worker(t.workerUrl),this._worker.addEventListener("message",this._workerMsg.bind(this)),this._callbacks=[],this._content={},this._processed=0,this._file=e}async open(){return await this._postMessage({type:"HELLO"},(e,t,n)=>{n.type==="READY"&&e()}),await this._postMessage({type:"OPEN",file:this._file},(e,t,n)=>{n.type==="OPENED"&&e(this)})}hasEncryptedData(){return this._postMessage({type:"CHECK_ENCRYPTION"},(e,t,n)=>{n.type==="ENCRYPTION_STATUS"&&e(n.status)})}usePassword(e){return this._postMessage({type:"SET_PASSPHRASE",passphrase:e},(t,n,s)=>{s.type==="PASSPHRASE_STATUS"&&t(s.status)})}getFilesObject(){return this._processed>0?Promise.resolve().then(()=>this._content):this._postMessage({type:"LIST_FILES"},(e,t,n)=>{if(n.type==="ENTRY"){const s=n.entry,[i,o]=this._getProp(this._content,s.path);return s.type==="FILE"&&(i[o]=new W(s.fileName,s.size,s.path,this)),!0}else n.type==="END"&&(this._processed=1,e(this._cloneContent(this._content)))})}getFilesArray(){return this.getFilesObject().then(e=>this._objectToArray(e))}extractSingleFile(e){return this._postMessage({type:"EXTRACT_SINGLE_FILE",target:e},(t,n,s)=>{if(s.type==="FILE"){const i=new File([s.entry.fileData],s.entry.fileName,{type:"application/octet-stream"});t(i)}})}extractFiles(e){return this._processed>1?Promise.resolve().then(()=>this._content):this._postMessage({type:"EXTRACT_FILES"},(t,n,s)=>{if(s.type==="ENTRY"){const[i,o]=this._getProp(this._content,s.entry.path);return s.entry.type==="FILE"&&(i[o]=new File([s.entry.fileData],s.entry.fileName,{type:"application/octet-stream"}),e!==void 0&&setTimeout(e.bind(null,{file:i[o],path:s.entry.path}))),!0}else s.type==="END"&&(this._processed=2,this._worker.terminate(),t(this._cloneContent(this._content)))})}_cloneContent(e){if(e instanceof File||e instanceof W||e===null)return e;const t={};for(const n of Object.keys(e))t[n]=this._cloneContent(e[n]);return t}_objectToArray(e,t=""){const n=[];for(const s of Object.keys(e))e[s]instanceof File||e[s]instanceof W||e[s]===null?n.push({file:e[s]||s,path:t}):n.push(...this._objectToArray(e[s],`${t}${s}/`));return n}_getProp(e,t){const n=t.split("/");n[n.length-1]===""&&n.pop();let s=e,i=null;for(const o of n)s[o]=s[o]||{},i=s,s=s[o];return[i,n[n.length-1]]}_postMessage(e,t){return this._worker.postMessage(e),new Promise((n,s)=>{this._callbacks.push(this._msgHandler.bind(this,t,n,s))})}_msgHandler(e,t,n,s){if(s.type==="BUSY")n("worker is busy");else if(s.type==="ERROR")n(s.error);else return e(t,n,s)}_workerMsg({data:e}){const t=this._callbacks[this._callbacks.length-1];t(e)||this._callbacks.pop()}}function he(_){let e,t,n,s,i,o,c,h,l,r,f,u,m;return h=new V({props:{title:"OK",on_click:_[7]}}),r=new V({props:{title:"Cancel",on_click:_[3]}}),{c(){e=k("div"),t=k("p"),n=O("Enter password:"),s=R(),i=k("input"),o=R(),c=k("div"),M(h.$$.fragment),l=R(),M(r.$$.fragment),this.h()},l(p){e=x(p,"DIV",{class:!0});var d=N(e);t=x(d,"P",{class:!0});var g=N(t);n=C(g,"Enter password:"),g.forEach(E),s=T(d),i=x(d,"INPUT",{type:!0,class:!0}),o=T(d),c=x(d,"DIV",{class:!0});var b=N(c);A(h.$$.fragment,b),l=T(b),A(r.$$.fragment,b),b.forEach(E),d.forEach(E),this.h()},h(){y(t,"class","my-2 text-[13px]"),i.autofocus=!0,y(i,"type","password"),y(i,"class","outline-none border border-slate-800 text-[11px] p-1"),y(c,"class","flex flex-row h-7 justify-evenly"),y(e,"class","absolute inset-4 flex flex-col overflow-hidden justify-between")},m(p,d){Y(p,e,d),w(e,t),w(t,n),w(e,s),w(e,i),X(i,_[6]),w(e,o),w(e,c),L(h,c,null),w(c,l),L(r,c,null),f=!0,i.focus(),u||(m=[q(i,"input",_[12]),q(i,"keydown",_[13])],u=!0)},p(p,d){d&64&&i.value!==p[6]&&X(i,p[6])},i(p){f||(v(h.$$.fragment,p),v(r.$$.fragment,p),f=!0)},o(p){P(h.$$.fragment,p),P(r.$$.fragment,p),f=!1},d(p){p&&E(e),j(h),j(r),u=!1,oe(m)}}}function de(_){let e,t,n,s=(_[1]?_[1].name:"")+"",i,o,c,h,l,r,f;return h=new _e({props:{style:"height:15px;margin:5px 0;flex-shrink:0;"}}),r=new V({props:{title:"Cancel",on_click:_[3]}}),{c(){e=k("div"),t=k("p"),n=O("Extracting "),i=O(s),o=O("..."),c=R(),M(h.$$.fragment),l=R(),M(r.$$.fragment),this.h()},l(u){e=x(u,"DIV",{class:!0});var m=N(e);t=x(m,"P",{class:!0});var p=N(t);n=C(p,"Extracting "),i=C(p,s),o=C(p,"..."),p.forEach(E),c=T(m),A(h.$$.fragment,m),l=T(m),A(r.$$.fragment,m),m.forEach(E),this.h()},h(){y(t,"class","my-2 text-[13px] text-ellipsis line-clamp-3"),y(e,"class","absolute inset-4 flex flex-col overflow-hidden justify-between")},m(u,m){Y(u,e,m),w(e,t),w(t,n),w(t,i),w(t,o),w(e,c),L(h,e,null),w(e,l),L(r,e,null),f=!0},p(u,m){(!f||m&2)&&s!==(s=(u[1]?u[1].name:"")+"")&&ee(i,s)},i(u){f||(v(h.$$.fragment,u),v(r.$$.fragment,u),f=!0)},o(u){P(h.$$.fragment,u),P(r.$$.fragment,u),f=!1},d(u){u&&E(e),j(h),j(r)}}}function Z(_){let e,t,n,s,i,o,c,h,l,r=_[4].message+"",f,u,m,p;return m=new V({props:{title:"OK",on_click:_[3]}}),{c(){e=k("div"),t=k("div"),n=k("img"),i=R(),o=k("p"),c=O("Error"),h=R(),l=k("p"),f=O(r),u=R(),M(m.$$.fragment),this.h()},l(d){e=x(d,"DIV",{class:!0});var g=N(e);t=x(g,"DIV",{class:!0});var b=N(t);n=x(b,"IMG",{src:!0,class:!0,alt:!0}),i=T(b),o=x(b,"P",{class:!0});var U=N(o);c=C(U,"Error"),U.forEach(E),b.forEach(E),h=T(g),l=x(g,"P",{class:!0});var H=N(l);f=C(H,r),H.forEach(E),u=T(g),A(m.$$.fragment,g),g.forEach(E),this.h()},h(){ae(n.src,s="/images/xp/icons/Critical.png")||y(n,"src",s),y(n,"class","w-8 h-8 mr-1"),y(n,"alt",""),y(o,"class","font-bold text-[13px]"),y(t,"class","flex flex-row mt-2 items-center"),y(l,"class","mb-2 text-[13px] text-ellipsis line-clamp-3"),y(e,"class","absolute inset-4 bg-xp-yellow flex flex-col justify-between overflow-hidden")},m(d,g){Y(d,e,g),w(e,t),w(t,n),w(t,i),w(t,o),w(o,c),w(e,h),w(e,l),w(l,f),w(e,u),L(m,e,null),p=!0},p(d,g){(!p||g&16)&&r!==(r=d[4].message+"")&&ee(f,r)},i(d){p||(v(m.$$.fragment,d),p=!0)},o(d){P(m.$$.fragment,d),p=!1},d(d){d&&E(e),j(m)}}}function me(_){let e,t,n,s,i;const o=[de,he],c=[];function h(r,f){return r[5]?1:0}t=h(_),n=c[t]=o[t](_);let l=_[4]&&Z(_);return{c(){e=k("div"),n.c(),s=R(),l&&l.c(),this.h()},l(r){e=x(r,"DIV",{slot:!0,class:!0});var f=N(e);n.l(f),s=T(f),l&&l.l(f),f.forEach(E),this.h()},h(){y(e,"slot","content"),y(e,"class","absolute inset-1 top-0 bg-xp-yellow")},m(r,f){Y(r,e,f),c[t].m(e,null),w(e,s),l&&l.m(e,null),i=!0},p(r,f){let u=t;t=h(r),t===u?c[t].p(r,f):(B(),P(c[u],1,1,()=>{c[u]=null}),K(),n=c[t],n?n.p(r,f):(n=c[t]=o[t](r),n.c()),v(n,1),n.m(e,s)),r[4]?l?(l.p(r,f),f&16&&v(l,1)):(l=Z(r),l.c(),v(l,1),l.m(e,null)):l&&(B(),P(l,1,1,()=>{l=null}),K())},i(r){i||(v(n),v(l),i=!0)},o(r){P(n),P(l),i=!1},d(r){r&&E(e),c[t].d(),l&&l.d()}}}function we(_){let e,t,n={options:_[2],on_click_close:_[3],$$slots:{content:[me]},$$scope:{ctx:_}};return e=new ce({props:n}),_[14](e),{c(){M(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,i){L(e,s,i),t=!0},p(s,[i]){const o={};i&4&&(o.options=s[2]),i&262258&&(o.$$scope={dirty:i,ctx:s}),e.$set(o)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){_[14](null),j(e,s)}}}function ge(_,e,t){let{id:n}=e,{window:s}=e,{self:i}=e,{parentNode:o}=e,{fs_item:c}=e,{exec_path:h}=e,l,r=!1,f=!1,u="",{options:m={title:"WinRAR",min_width:250,min_height:220,width:250,height:220,resizable:!1,maximize_btn_disabled:!0,icon:"/images/xp/icons/RAR.png",id:n,exec_path:h}}=e;$.init({workerUrl:"/js/libarchive.js/dist/worker-bundle.js"}),re(async()=>{if(c){let a=await J(c.id);const F=await $.open(a);t(5,r=await F.hasEncryptedData()),r||await g(a)}});async function p(){f=!0,fe.update(a=>a.filter(F=>F!=i)),i.$destroy()}async function d(){t(5,r=!1);let a=await J(c.id);await g(a,u)}async function g(a,F=null){const I=await $.open(a);F&&await I.usePassword(F);try{let S=await I.extractFiles();for(let z of Object.keys(S))await b(S[z],c.parent,z)}catch(S){console.log(S),t(4,l=S);return}p()}async function b(a,F,I){if(!f)if(a instanceof File){let S=new File([a],a.name,{type:ue(a.name)||a.type});await Q("file",G(I),pe(I,G(I)),F,S)}else{let S=await Q("folder","",I,F,null);for(let z of Object.keys(a))await b(a[z],S,z)}}function U(){u=this.value,t(6,u)}const H=a=>a.key=="Enter"&&d();function te(a){le[a?"unshift":"push"](()=>{s=a,t(0,s)})}return _.$$set=a=>{"id"in a&&t(8,n=a.id),"window"in a&&t(0,s=a.window),"self"in a&&t(9,i=a.self),"parentNode"in a&&t(10,o=a.parentNode),"fs_item"in a&&t(1,c=a.fs_item),"exec_path"in a&&t(11,h=a.exec_path),"options"in a&&t(2,m=a.options)},[s,c,m,p,l,r,u,d,n,i,o,h,U,H,te]}class Me extends se{constructor(e){super(),ne(this,e,ge,we,ie,{id:8,window:0,self:9,parentNode:10,fs_item:1,exec_path:11,options:2,destroy:3})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),D()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),D()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),D()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),D()}get fs_item(){return this.$$.ctx[1]}set fs_item(e){this.$$set({fs_item:e}),D()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),D()}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),D()}get destroy(){return this.$$.ctx[3]}}export{Me as default};
