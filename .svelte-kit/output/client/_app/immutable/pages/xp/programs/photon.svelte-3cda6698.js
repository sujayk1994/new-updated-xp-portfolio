import{_ as R}from"../../../chunks/preload-helper-c28b9807.js";import{S as $,i as ee,X as p,s as te,w as G,x as L,y as V,f as w,t as x,B as A,P as F,l as E,a as ie,m as P,n as k,c as ne,h as y,N as se,p as d,b as J,J as N,O as oe,g as ae,d as re,_ as S}from"../../../chunks/index-59da92c8.js";import{W as le}from"../../../chunks/Window-6d40284c.js";import{h as fe,z as me,r as ce,a as _e}from"../../../chunks/store-fabc0359.js";import{n as z}from"../../../chunks/utils-1f7a3290.js";import{d as q,j as ue,s as de,e as pe}from"../../../chunks/fs-94169c0b.js";import{D as he}from"../../../chunks/DumbProgress-ba1b12c7.js";import"../../../chunks/TitleBar-a503be9c.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-5377a032.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-f715ee8c.js";import"../../../chunks/admin-b2f51e94.js";import"../../../chunks/ProgressBar-a36ef5c0.js";function M(o){let e,n,a;return n=new he({props:{style:"width:150px;height:15px;"}}),{c(){e=E("div"),G(n.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=k(e);L(n.$$.fragment,l),l.forEach(y),this.h()},h(){d(e,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(s,l){J(s,e,l),V(n,e,null),a=!0},i(s){a||(w(n.$$.fragment,s),a=!0)},o(s){x(n.$$.fragment,s),a=!1},d(s){s&&y(e),A(n)}}}function ge(o){let e,n,a,s,l,r,m,g,i=!o[4]&&M();return{c(){e=E("div"),i&&i.c(),n=ie(),a=E("iframe"),this.h()},l(c){e=P(c,"DIV",{slot:!0,class:!0});var _=k(e);i&&i.l(_),n=ne(_),a=P(_,"IFRAME",{src:!0,width:!0,height:!0,class:!0});var f=k(a);f.forEach(y),_.forEach(y),this.h()},h(){se(a.src,s="/html/photon/app/index.html")||d(a,"src",s),d(a,"width","100%"),d(a,"height","100%"),d(a,"class",l="inset-0 absolute bg-black "+(o[4]?"":"opacity-0")+" "+(o[0]?.z_index==o[5]?"pointer-events-auto":"pointer-events-none")),d(e,"slot","content"),d(e,"class","absolute inset-0 flex flex-col bg-black")},m(c,_){J(c,e,_),i&&i.m(e,null),N(e,n),N(e,a),o[12](a),r=!0,m||(g=oe(a,"load",o[6]),m=!0)},p(c,_){c[4]?i&&(ae(),x(i,1,1,()=>{i=null}),re()):i?_&16&&w(i,1):(i=M(),i.c(),w(i,1),i.m(e,n)),(!r||_&49&&l!==(l="inset-0 absolute bg-black "+(c[4]?"":"opacity-0")+" "+(c[0]?.z_index==c[5]?"pointer-events-auto":"pointer-events-none")))&&d(a,"class",l)},i(c){r||(w(i),r=!0)},o(c){x(i),r=!1},d(c){c&&y(e),i&&i.d(),o[12](null),m=!1,g()}}}function we(o){let e,n,a={options:o[2],on_click_close:o[1],$$slots:{content:[ge]},$$scope:{ctx:o}};return e=new le({props:a}),o[13](e),{c(){G(e.$$.fragment)},l(s){L(e.$$.fragment,s)},m(s,l){V(e,s,l),n=!0},p(s,[l]){const r={};l&4&&(r.options=s[2]),l&1048633&&(r.$$scope={dirty:l,ctx:s}),e.$set(r)},i(s){n||(w(e.$$.fragment,s),n=!0)},o(s){x(e.$$.fragment,s),n=!1},d(s){o[13](null),A(e,s)}}}async function ye({node_ref:o,filetypes_desc:e,filetypes:n}){return new Promise(async(a,s)=>{const l=(await R(()=>import("../../../chunks/OpenModal-db57037d.js"),["_app/immutable/chunks/OpenModal-db57037d.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-59da92c8.js","_app/immutable/chunks/TitleBar-a503be9c.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-f715ee8c.js","_app/immutable/chunks/store-fabc0359.js","_app/immutable/chunks/index-5377a032.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-94169c0b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/admin-b2f51e94.js","_app/immutable/chunks/Button-5a8d2150.js","_app/immutable/chunks/Previewable-21087848.js"])).default;let r=new l({target:o,props:{filetypes:n,filetypes_desc:e}});r.self=r,r.on_open=()=>{a(r.selected_items),r.destroy()}})}async function be({node_ref:o,filetypes:e,id:n,current_filetype:a}){return new Promise(async(s,l)=>{const r=(await R(()=>import("../../../chunks/SaveModal-ae7d11c7.js"),["_app/immutable/chunks/SaveModal-ae7d11c7.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-59da92c8.js","_app/immutable/chunks/TitleBar-a503be9c.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-f715ee8c.js","_app/immutable/chunks/store-fabc0359.js","_app/immutable/chunks/index-5377a032.js","_app/immutable/chunks/fs-94169c0b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/admin-b2f51e94.js","_app/immutable/chunks/Button-5a8d2150.js","_app/immutable/chunks/Previewable-21087848.js"])).default;let m=new r({target:o,props:{filetypes:e,selected_filetype:a,id:n}});m.self=m,m.on_save=()=>{s({parent_id:m.parent_id,filename:m.filename,selected_filetype:m.selected_filetype}),m.destroy()}})}function O(o){return o==".jpg"||o==".jpeg"?"jpeg":"png"}function xe(o,e,n){let a,s;F(o,fe,t=>n(15,a=t)),F(o,me,t=>n(5,s=t));let{id:l}=e,{window:r}=e,{self:m}=e,{parentNode:g}=e,{fs_item:i}=e,{exec_path:c}=e,_=[{name:"Portable Network Graphics",mime:"image/png",value:"image/png",ext:".png"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpg"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpeg"},{name:"Windows OS/2 Bitmap Graphics",mime:"image/bmp",value:"image/bmp",ext:".bmp"}];_=_.map(t=>(t.name=t.name+" ("+t.ext+")",t));let f,W=!1;async function U(){ce.update(t=>t.filter(u=>u!=m)),m.$destroy()}let v={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:j={title:i==null?"Photon Editor":i.name,min_width:500,min_height:400,width:Math.min(v.width-20,(v.height-20)*1.6),height:Math.min(v.height-20),icon:"/images/xp/icons/Photon.png",id:l,exec_path:c}}=e;async function B(){let t=await ye({node_ref:r.node_ref,filetypes_desc:"Image Files",filetypes:_.map(h=>h.ext)});n(7,i=a[t[0]]);let u=await q(t[0]);return console.log({fs_item:i}),u}async function C(){if(i!=null){let t=i?.ext||".png",u=O(t);console.log({format:u});let h=z(f.contentWindow.imageEditor.toDataURL({format:u})),b=new File([h],i.name);ue(i.id,b),r.show_toast({message:"Changes Saved!"})}else D()}async function D(){console.log(i);let t=_.find(Z=>Z.ext==i?.ext);t==null&&(t=_[0]);let{parent_id:u,filename:h,selected_filetype:b}=await be({id:i?.parent,node_ref:r.node_ref,filetypes:_,current_filetype:t}),K=O(b.ext),Q=z(f.contentWindow.imageEditor.toDataURL({format:K})),Y=new File([Q],h),I=de.generate();await pe(h,b.ext,Y,u,I),i==null&&n(7,i=a[I])}async function T(){if(f.contentWindow.setup_ui(),i!=null){let t=await q(i.id);f.contentWindow.imageEditor.loadImageFromFile(t,i.name)}n(3,f.contentWindow.about_func=()=>{_e.set({path:"./programs/internet_explorer.svelte",fs_item:{url:"https://ui.toast.com/tui-image-editor"}})},f),n(3,f.contentWindow.load_file_func=async()=>{let t=await B();f.contentWindow.imageEditor.loadImageFromFile(t,i.name)},f),n(3,f.contentWindow.save_file_func=async()=>{await C()},f),n(3,f.contentWindow.save_file_as_func=async()=>{await D()},f),n(4,W=!0)}function H(t){S[t?"unshift":"push"](()=>{f=t,n(3,f)})}function X(t){S[t?"unshift":"push"](()=>{r=t,n(0,r)})}return o.$$set=t=>{"id"in t&&n(8,l=t.id),"window"in t&&n(0,r=t.window),"self"in t&&n(9,m=t.self),"parentNode"in t&&n(10,g=t.parentNode),"fs_item"in t&&n(7,i=t.fs_item),"exec_path"in t&&n(11,c=t.exec_path),"options"in t&&n(2,j=t.options)},o.$$.update=()=>{o.$$.dirty&129&&i&&r&&r.update_title(i.name)},[r,U,j,f,W,s,T,i,l,m,g,c,H,X]}class Ge extends ${constructor(e){super(),ee(this,e,xe,we,te,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(e){this.$$set({id:e}),p()}get window(){return this.$$.ctx[0]}set window(e){this.$$set({window:e}),p()}get self(){return this.$$.ctx[9]}set self(e){this.$$set({self:e}),p()}get parentNode(){return this.$$.ctx[10]}set parentNode(e){this.$$set({parentNode:e}),p()}get fs_item(){return this.$$.ctx[7]}set fs_item(e){this.$$set({fs_item:e}),p()}get exec_path(){return this.$$.ctx[11]}set exec_path(e){this.$$set({exec_path:e}),p()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(e){this.$$set({options:e}),p()}}export{Ge as default};
