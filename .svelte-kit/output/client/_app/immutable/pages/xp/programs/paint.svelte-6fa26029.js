import{_ as T}from"../../../chunks/preload-helper-c28b9807.js";import{S as R,i as U,X as h,s as V,w as L,x as X,y as K,f as Q,t as Y,B as Z,P as k,l as I,m as N,n as S,h as P,N as $,p as w,q,b as ee,J as te,O as ie,_ as B}from"../../../chunks/index-59da92c8.js";import{W as ne}from"../../../chunks/Window-6d40284c.js";import{h as se,z as ae,r as oe,a as H}from"../../../chunks/store-fabc0359.js";import{j as le}from"../../../chunks/utils-1f7a3290.js";import{d as O,j as re,s as me,e as _e}from"../../../chunks/fs-94169c0b.js";import"../../../chunks/TitleBar-a503be9c.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-355ed6be.js";import"../../../chunks/index-5377a032.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/finder-f715ee8c.js";import"../../../chunks/admin-b2f51e94.js";function fe(s){let t,i,_,a,r,n;return{c(){t=I("div"),i=I("iframe"),this.h()},l(o){t=N(o,"DIV",{slot:!0,class:!0});var c=S(t);i=N(c,"IFRAME",{src:!0,width:!0,height:!0,class:!0,style:!0});var l=S(i);l.forEach(P),c.forEach(P),this.h()},h(){$(i.src,_="/html/jspaint/index.html")||w(i,"src",_),w(i,"width","100%"),w(i,"height","100%"),w(i,"class",a="inset-0 absolute bg-white "+(s[0]?.z_index==s[5]?"pointer-events-auto":"pointer-events-none")),q(i,"visibility",s[4]?"visible":"hidden"),w(t,"slot","content"),w(t,"class","absolute inset-1 top-0 flex flex-col bg-[rgb(192,192,192)] overflow-hidden")},m(o,c){ee(o,t,c),te(t,i),s[12](i),r||(n=ie(i,"load",s[6]),r=!0)},p(o,c){c&33&&a!==(a="inset-0 absolute bg-white "+(o[0]?.z_index==o[5]?"pointer-events-auto":"pointer-events-none"))&&w(i,"class",a),c&16&&q(i,"visibility",o[4]?"visible":"hidden")},d(o){o&&P(t),s[12](null),r=!1,n()}}}function ce(s){let t,i,_={options:s[2],on_click_close:s[1],$$slots:{content:[fe]},$$scope:{ctx:s}};return t=new ne({props:_}),s[13](t),{c(){L(t.$$.fragment)},l(a){X(t.$$.fragment,a)},m(a,r){K(t,a,r),i=!0},p(a,[r]){const n={};r&4&&(n.options=a[2]),r&524345&&(n.$$scope={dirty:r,ctx:a}),t.$set(n)},i(a){i||(Q(t.$$.fragment,a),i=!0)},o(a){Y(t.$$.fragment,a),i=!1},d(a){s[13](null),Z(t,a)}}}async function z({node_ref:s,filetypes_desc:t,filetypes:i}){return new Promise(async(_,a)=>{const r=(await T(()=>import("../../../chunks/OpenModal-db57037d.js"),["_app/immutable/chunks/OpenModal-db57037d.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-59da92c8.js","_app/immutable/chunks/TitleBar-a503be9c.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-f715ee8c.js","_app/immutable/chunks/store-fabc0359.js","_app/immutable/chunks/index-5377a032.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-94169c0b.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/admin-b2f51e94.js","_app/immutable/chunks/Button-5a8d2150.js","_app/immutable/chunks/Previewable-21087848.js"])).default;let n=new r({target:s,props:{filetypes:i,filetypes_desc:t}});n.self=n,n.on_open=()=>{_(n.selected_items),n.destroy()}})}async function de({node_ref:s,filetypes:t,id:i,current_filetype:_}){return new Promise(async(a,r)=>{const n=(await T(()=>import("../../../chunks/SaveModal-ae7d11c7.js"),["_app/immutable/chunks/SaveModal-ae7d11c7.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-59da92c8.js","_app/immutable/chunks/TitleBar-a503be9c.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-f715ee8c.js","_app/immutable/chunks/store-fabc0359.js","_app/immutable/chunks/index-5377a032.js","_app/immutable/chunks/fs-94169c0b.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-355ed6be.js","_app/immutable/chunks/admin-b2f51e94.js","_app/immutable/chunks/Button-5a8d2150.js","_app/immutable/chunks/Previewable-21087848.js"])).default;let o=new n({target:s,props:{filetypes:t,selected_filetype:_,id:i}});o.self=o,o.on_save=()=>{a({parent_id:o.parent_id,filename:o.filename,selected_filetype:o.selected_filetype}),o.destroy()}})}function ue(s,t,i){let _,a;k(s,se,e=>i(15,_=e)),k(s,ae,e=>i(5,a=e));let{id:r}=t,{window:n}=t,{self:o}=t,{parentNode:c}=t,{fs_item:l}=t,{exec_path:v}=t,u=[{name:"Portable Network Graphics",mime:"image/png",value:"image/png",ext:".png"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpg"},{name:"JPEG images",mime:"image/jpeg",value:"image/jpeg",ext:".jpeg"},{name:"Windows OS/2 Bitmap Graphics",mime:"image/bmp",value:"image/bmp",ext:".bmp"}];u=u.map(e=>(e.name=e.name+" ("+e.ext+")",e));let p,j=!1;async function G(){oe.update(e=>e.filter(d=>d!=o)),o.$destroy()}let{options:D={title:l==null?"Paint":l.name,min_width:500,min_height:400,width:700,height:500,icon:"/images/xp/icons/Paint.png",id:r,exec_path:v}}=t;async function W(){let e=await z({node_ref:n.node_ref,filetypes_desc:"Image Files",filetypes:u.map(m=>m.ext)}),d=_[e[0]];H.set({path:"./programs/paint.svelte",fs_item:d})}async function A(){let e=await z({node_ref:n.node_ref,filetypes_desc:"Image Files",filetypes:u.map(m=>m.ext)});i(7,l=_[e[0]]);let d=await O(e[0]);return console.log({fs_item:l}),d}async function E(){console.log(l);let e=u.find(g=>g.ext==l?.ext);e==null&&(e=u[0]);let{parent_id:d,filename:m,selected_filetype:f}=await de({id:l?.parent,node_ref:n.node_ref,filetypes:u,current_filetype:e});console.log(f),p.contentDocument.querySelector(".main-canvas").toBlob(async g=>{let x=new File([g],m),b=me.generate();await _e(m,f.ext,x,d,b),l==null&&i(7,l=_[b])},f.mime)}async function C(){i(4,j=!0);var e=p.contentWindow;if(e.set_theme("classic.css"),e.open_in_new_window=W,e.open_empty_window=()=>{H.set({path:"./programs/paint.svelte"})},l!=null){console.log({fs_item:l});let m=await O(l.id);console.log(m),e.open_from_file(m)}d(()=>e.systemHooks,500,()=>{e.systemHooks.showSaveFileDialog=async({formats:m,defaultFileName:f,defaultPath:y,defaultFileFormatID:g,getBlob:x,savedCallbackUnreliable:b,dialogTitle:F})=>{await E()},e.systemHooks.showOpenFileDialog=async({formats:m})=>{let f=await A();return{file:f,file_handle:f}},e.systemHooks.writeBlobToHandle=async(m,f)=>{if(console.log("writeBlobtoHandle"),l!=null){let y=l?.ext||".png",g=le(y,"image/png");console.log({mimetype:g}),p.contentDocument.querySelector(".main-canvas").toBlob(b=>{let F=new File([b],l.name);re(l.id,F),n.show_toast({message:"Changes Saved!"})},g)}else E()},p.contentDocument.querySelector(".menus").style.pointerEvents="auto"});function d(m,f,y){m()?y():setTimeout(d,f,m,f,y)}}function J(e){B[e?"unshift":"push"](()=>{p=e,i(3,p)})}function M(e){B[e?"unshift":"push"](()=>{n=e,i(0,n)})}return s.$$set=e=>{"id"in e&&i(8,r=e.id),"window"in e&&i(0,n=e.window),"self"in e&&i(9,o=e.self),"parentNode"in e&&i(10,c=e.parentNode),"fs_item"in e&&i(7,l=e.fs_item),"exec_path"in e&&i(11,v=e.exec_path),"options"in e&&i(2,D=e.options)},s.$$.update=()=>{s.$$.dirty&129&&l&&n&&n.update_title(l.name)},[n,G,D,p,j,a,C,l,r,o,c,v,J,M]}class Ie extends R{constructor(t){super(),U(this,t,ue,ce,V,{id:8,window:0,self:9,parentNode:10,fs_item:7,exec_path:11,destroy:1,options:2})}get id(){return this.$$.ctx[8]}set id(t){this.$$set({id:t}),h()}get window(){return this.$$.ctx[0]}set window(t){this.$$set({window:t}),h()}get self(){return this.$$.ctx[9]}set self(t){this.$$set({self:t}),h()}get parentNode(){return this.$$.ctx[10]}set parentNode(t){this.$$set({parentNode:t}),h()}get fs_item(){return this.$$.ctx[7]}set fs_item(t){this.$$set({fs_item:t}),h()}get exec_path(){return this.$$.ctx[11]}set exec_path(t){this.$$set({exec_path:t}),h()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(t){this.$$set({options:t}),h()}}export{Ie as default};
