import{_ as T}from"../../../chunks/preload-helper-c28b9807.js";import{S as oe,i as ae,X as g,s as re,w as U,x as B,y as C,O as H,f as P,t as N,B as J,P as R,o as le,W as fe,l as E,a as ce,m as I,n as M,c as _e,h as b,p as m,N as S,q as V,b as X,J as q,g as ue,d as de,_ as F}from"../../../chunks/index-7043d62e.js";import{W as me}from"../../../chunks/Window-b5e17ac1.js";import{h as pe,z as we,r as he}from"../../../chunks/store-a53f3f11.js";import{l as ge}from"../../../chunks/utils-1f7a3290.js";import{d as L,s as ye,e as be,j as ve}from"../../../chunks/fs-359b7395.js";import{t as O}from"../../../chunks/finder-63196e92.js";import{D as ke}from"../../../chunks/DumbProgress-474c7fb6.js";import"../../../chunks/TitleBar-43a93d4a.js";import"../../../chunks/lodash-b0811ec1.js";import"../../../chunks/_commonjsHelpers-cea7ac1a.js";import"../../../chunks/index-e9763cd9.js";import"../../../chunks/index-bc59e2a0.js";import"../../../chunks/system-e72d84b7.js";import"../../../chunks/admin-093cca4c.js";import"../../../chunks/ProgressBar-faa0e4b3.js";const{window:xe}=fe;function j(o){let t,s,l;return s=new ke({props:{style:"width:150px;height:15px;"}}),{c(){t=E("div"),U(s.$$.fragment),this.h()},l(n){t=I(n,"DIV",{class:!0});var f=M(t);B(s.$$.fragment,f),f.forEach(b),this.h()},h(){m(t,"class","absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono")},m(n,f){X(n,t,f),C(s,t,null),l=!0},i(n){l||(P(s.$$.fragment,n),l=!0)},o(n){N(s.$$.fragment,n),l=!1},d(n){n&&b(t),J(s)}}}function Pe(o){let t,s,l,n,f,a,i,d,p,r=!o[5]&&j();return{c(){t=E("div"),s=E("div"),r&&r.c(),l=ce(),n=E("iframe"),this.h()},l(_){t=I(_,"DIV",{slot:!0,class:!0});var u=M(t);s=I(u,"DIV",{class:!0});var w=M(s);r&&r.l(w),l=_e(w),n=I(w,"IFRAME",{class:!0,src:!0,allow:!0,frameborder:!0});var W=M(n);W.forEach(b),w.forEach(b),u.forEach(b),this.h()},h(){m(n,"class",f="w-full h-full "+(o[5]?"":"hidden")+" "+(o[0]?.z_index==o[6]?"pointer-events-auto":"pointer-events-none")),S(n.src,a=o[3])||m(n,"src",a),m(n,"allow","gamepad *;"),m(n,"frameborder","0"),n.allowFullscreen=!0,V(n,"background-color",o[7],!1),m(s,"class","absolute inset-0 overflow-auto bg-slate-100 font-sans"),V(s,"background-color",o[7],!1),m(t,"slot","content"),m(t,"class","absolute inset-0.5 top-0 flex flex-col bg-slate-800")},m(_,u){X(_,t,u),q(t,s),r&&r.m(s,null),q(s,l),q(s,n),o[16](n),i=!0,d||(p=H(n,"load",o[8]),d=!0)},p(_,u){_[5]?r&&(ue(),N(r,1,1,()=>{r=null}),de()):r?u&32&&P(r,1):(r=j(),r.c(),P(r,1),r.m(s,l)),(!i||u&97&&f!==(f="w-full h-full "+(_[5]?"":"hidden")+" "+(_[0]?.z_index==_[6]?"pointer-events-auto":"pointer-events-none")))&&m(n,"class",f),(!i||u&8&&!S(n.src,a=_[3]))&&m(n,"src",a)},i(_){i||(P(r),i=!0)},o(_){N(r),i=!1},d(_){_&&b(t),r&&r.d(),o[16](null),d=!1,p()}}}function De(o){let t,s,l,n,f={options:o[2],on_click_close:o[1],on_focused:o[9],$$slots:{content:[Pe]},$$scope:{ctx:o}};return t=new me({props:f}),o[17](t),{c(){U(t.$$.fragment)},l(a){B(t.$$.fragment,a)},m(a,i){C(t,a,i),s=!0,l||(n=H(xe,"message",o[10]),l=!0)},p(a,[i]){const d={};i&4&&(d.options=a[2]),i&67108985&&(d.$$scope={dirty:i,ctx:a}),t.$set(d)},i(a){s||(P(t.$$.fragment,a),s=!0)},o(a){N(t.$$.fragment,a),s=!1},d(a){o[17](null),J(t,a),l=!1,n()}}}async function Ee({node_ref:o,filetypes_desc:t,filetypes:s,multiple:l}){return new Promise(async(n,f)=>{const a=(await T(()=>import("../../../chunks/OpenModal-c8aab4f0.js"),["_app/immutable/chunks/OpenModal-c8aab4f0.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let i=new a({target:o,props:{filetypes:s,filetypes_desc:t,multiple:l}});i.self=i,i.on_open=()=>{n(i.selected_items),i.destroy()}})}async function Ie({node_ref:o,filetypes:t,id:s,current_filetype:l}){return new Promise(async(n,f)=>{const a=(await T(()=>import("../../../chunks/SaveModal-8f801486.js"),["_app/immutable/chunks/SaveModal-8f801486.js","_app/immutable/assets/Button-bfb744c1.css","_app/immutable/chunks/index-7043d62e.js","_app/immutable/chunks/TitleBar-43a93d4a.js","_app/immutable/chunks/lodash-b0811ec1.js","_app/immutable/chunks/_commonjsHelpers-cea7ac1a.js","_app/immutable/chunks/system-e72d84b7.js","_app/immutable/chunks/finder-63196e92.js","_app/immutable/chunks/store-a53f3f11.js","_app/immutable/chunks/index-bc59e2a0.js","_app/immutable/chunks/fs-359b7395.js","_app/immutable/chunks/utils-1f7a3290.js","_app/immutable/chunks/index-e9763cd9.js","_app/immutable/chunks/admin-093cca4c.js","_app/immutable/chunks/Button-4430907d.js","_app/immutable/chunks/Previewable-95faa8f2.js"])).default;let i=new a({target:o,props:{filetypes:t,selected_filetype:l,id:s}});i.self=i,i.on_save=()=>{n({parent_id:i.parent_id,filename:i.filename,selected_filetype:i.selected_filetype}),i.destroy()}})}function Me(o,t,s){let l,n;R(o,pe,e=>s(18,l=e)),R(o,we,e=>s(6,n=e));let{id:f}=t,{window:a}=t,{self:i}=t,{parentNode:d}=t,{webapp:p}=t,r,{exec_path:_}=t,u,w=!1,W=p?.background||"#ffffff";le(async()=>{s(3,r=se(p.url))});async function G(){he.update(e=>e.filter(c=>c!=i)),i.$destroy()}let z={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:A={title:p.name,min_width:500,min_height:400,width:Math.min(z.width-20,(z.height-20)*1.6),height:Math.min(z.height-20),icon:p.icon,id:f,exec_path:_}}=t;async function K(){s(5,w=!0)}function Q(){setTimeout(()=>{u&&u.contentWindow.focus()},500)}async function Y(e="",c=[],v=!0){console.log(e),console.log(c);let k=await Ee({node_ref:a.node_ref,filetypes_desc:e,filetypes:c,multiple:v});console.log(k);let x=[];for(let h of k){let y=await L(h);x.push({id:h,win32_name:l[h].name,win32_path:O(h),file:y})}await D({type:"files_picked",files:x})}async function Z(e,c){if(!(e instanceof File)||!Array.isArray(c))return;c=c.map(y=>(y.name=y.desc+` (${y.ext})`,y));let{parent_id:v,filename:k,selected_filetype:x}=await Ie({node_ref:a.node_ref,filetypes:c,current_filetype:c[0]}),h=ye.generate();e=new File([e],k,{type:x.mime}),await be(k,x.ext,e,v,h),await D({type:"file_saved_as",fs_id:h})}async function $(e,c){await ve(c,e),await D({type:"file_saved"})}async function ee(e){let c=l[e];if(e){let v=await L(e);await D({type:"file",file:{win32_path:O(e),win32_name:c.name,file:v}})}}async function te({data:e}){if(e?.program_id!=f)return;console.log(e);let{type:c}=e;c=="pick_files"?await Y(e.desc,e.exts,e.multiple):c=="save_file"?await $(e.file,e.fs_id):c=="save_file_as"?await Z(e.file,e.types):c=="get_file"&&await ee(e.fs_id)}function se(e){return e=new URL(e),e.searchParams.set("program_id",f),e.searchParams.set("parent_origin",ge().location.origin),e.href}async function D(e){u.contentWindow.postMessage(e,new URL(r).origin)}function ne(e){F[e?"unshift":"push"](()=>{u=e,s(4,u)})}function ie(e){F[e?"unshift":"push"](()=>{a=e,s(0,a)})}return o.$$set=e=>{"id"in e&&s(11,f=e.id),"window"in e&&s(0,a=e.window),"self"in e&&s(12,i=e.self),"parentNode"in e&&s(13,d=e.parentNode),"webapp"in e&&s(14,p=e.webapp),"exec_path"in e&&s(15,_=e.exec_path),"options"in e&&s(2,A=e.options)},[a,G,A,r,u,w,n,W,K,Q,te,f,i,d,p,_,ne,ie]}class He extends oe{constructor(t){super(),ae(this,t,Me,De,re,{id:11,window:0,self:12,parentNode:13,webapp:14,exec_path:15,destroy:1,options:2})}get id(){return this.$$.ctx[11]}set id(t){this.$$set({id:t}),g()}get window(){return this.$$.ctx[0]}set window(t){this.$$set({window:t}),g()}get self(){return this.$$.ctx[12]}set self(t){this.$$set({self:t}),g()}get parentNode(){return this.$$.ctx[13]}set parentNode(t){this.$$set({parentNode:t}),g()}get webapp(){return this.$$.ctx[14]}set webapp(t){this.$$set({webapp:t}),g()}get exec_path(){return this.$$.ctx[15]}set exec_path(t){this.$$set({exec_path:t}),g()}get destroy(){return this.$$.ctx[1]}get options(){return this.$$.ctx[2]}set options(t){this.$$set({options:t}),g()}}export{He as default};
