import{q as s,i as d}from"../../../_app/immutable/chunks/db-aae5410a.js";import"pg";let a=!1;async function c(){a||(await d(),a=!0)}async function y({url:e}){await c();try{const i=e.searchParams.get("id");if(i){const t=await s("SELECT * FROM admin_videos WHERE id = $1 AND is_public = TRUE",[i]);if(t.rows.length===0)return new Response(JSON.stringify({error:"Video not found"}),{status:404,headers:{"Content-Type":"application/json"}});const u=t.rows[0];return new Response(JSON.stringify({success:!0,video:r(u)}),{status:200,headers:{"Content-Type":"application/json"}})}const n=(await s("SELECT * FROM admin_videos WHERE is_public = TRUE ORDER BY display_order ASC, created_at DESC")).rows.map(r);return new Response(JSON.stringify({success:!0,videos:n}),{status:200,headers:{"Content-Type":"application/json"}})}catch(i){return console.error("Error fetching videos:",i),new Response(JSON.stringify({error:"Failed to fetch videos"}),{status:500,headers:{"Content-Type":"application/json"}})}}function r(e){return{id:e.id.toString(),title:e.title,youtubeId:e.youtube_id,channel:e.channel,description:e.description||"",duration:e.duration,views:e.views,thumbnail:e.thumbnail_url||`https://img.youtube.com/vi/${e.youtube_id}/maxresdefault.jpg`,youtubeUrl:`https://www.youtube.com/embed/${e.youtube_id}`,time:f(e.created_at),createdAt:e.created_at}}function f(e){const i=new Date,o=new Date(e),n=i-o,t=Math.floor(n/(1e3*60*60*24));return t<1?"Today":t===1?"1 day ago":t<7?`${t} days ago`:t<14?"1 week ago":t<30?`${Math.floor(t/7)} weeks ago`:t<60?"1 month ago":t<365?`${Math.floor(t/30)} months ago`:`${Math.floor(t/365)} years ago`}export{y as GET};
