import{v as g}from"../../../../_app/immutable/chunks/auth-e33c57ab.js";import{q as n,i as l}from"../../../../_app/immutable/chunks/db-aae5410a.js";import"bcrypt";import"jsonwebtoken";import"crypto";import"pg";let c=!1;async function u(){c||(await l(),c=!0)}function p(t){const o=t.headers.get("cookie")||"",s=Object.fromEntries(o.split(";").map(r=>{const[i,...a]=r.trim().split("=");return[i,a.join("=")]})).admin_token;return s?g(s):null}async function _({request:t}){await u();try{const o=await n("SELECT * FROM boot_screen_settings ORDER BY id DESC LIMIT 1");if(o.rows.length>0){const e=o.rows[0];return new Response(JSON.stringify({success:!0,settings:{type:e.type,customGif:e.custom_gif,showLogo:e.show_logo,showProgress:e.show_progress,showCopyright:e.show_copyright,backgroundColor:e.background_color}}),{status:200,headers:{"Content-Type":"application/json"}})}return new Response(JSON.stringify({success:!0,settings:{type:"default",customGif:null,showLogo:!0,showProgress:!0,showCopyright:!0,backgroundColor:"#000000"}}),{status:200,headers:{"Content-Type":"application/json"}})}catch(o){return console.error("Error fetching boot screen settings:",o),new Response(JSON.stringify({success:!1,error:"Failed to fetch boot screen settings",settings:{type:"default",customGif:null,showLogo:!0,showProgress:!0,showCopyright:!0,backgroundColor:"#000000"}}),{status:200,headers:{"Content-Type":"application/json"}})}}async function b({request:t}){if(await u(),!p(t))return new Response(JSON.stringify({success:!1,error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});try{const e=await t.json(),{settings:s}=e;if(!s)return new Response(JSON.stringify({success:!1,error:"Settings required"}),{status:400,headers:{"Content-Type":"application/json"}});if(s.customGif&&s.customGif.length*.75>5242880)return new Response(JSON.stringify({success:!1,error:"Image too large. Maximum size is 5MB."}),{status:400,headers:{"Content-Type":"application/json"}});const r=await n("SELECT id FROM boot_screen_settings ORDER BY id DESC LIMIT 1");return r.rows.length>0?await n(`UPDATE boot_screen_settings 
                 SET type = $1, custom_gif = $2, show_logo = $3, show_progress = $4, 
                     show_copyright = $5, background_color = $6, updated_at = CURRENT_TIMESTAMP
                 WHERE id = $7`,[s.type||"default",s.customGif||null,s.showLogo!==!1,s.showProgress!==!1,s.showCopyright!==!1,s.backgroundColor||"#000000",r.rows[0].id]):await n(`INSERT INTO boot_screen_settings (type, custom_gif, show_logo, show_progress, show_copyright, background_color)
                 VALUES ($1, $2, $3, $4, $5, $6)`,[s.type||"default",s.customGif||null,s.showLogo!==!1,s.showProgress!==!1,s.showCopyright!==!1,s.backgroundColor||"#000000"]),new Response(JSON.stringify({success:!0,message:"Boot screen settings saved"}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error saving boot screen settings:",e),new Response(JSON.stringify({success:!1,error:"Failed to save boot screen settings"}),{status:500,headers:{"Content-Type":"application/json"}})}}export{_ as GET,b as POST};
