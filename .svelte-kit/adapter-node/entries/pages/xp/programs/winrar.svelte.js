import{c as E,v as d,e as v}from"../../../../_app/immutable/chunks/index-ff400fad.js";import{W as k}from"../../../../_app/immutable/chunks/Window-e98aeb2f.js";import{B as x}from"../../../../_app/immutable/chunks/Button-c9221fbd.js";import{r as N}from"../../../../_app/immutable/chunks/store-3e4ea696.js";import"../../../../_app/immutable/chunks/system-eda41220.js";import"short-uuid";import"../../../../_app/immutable/chunks/finder-762cc408.js";import"buffer";import{D as P}from"../../../../_app/immutable/chunks/DumbProgress-1d1763f5.js";import"../../../../_app/immutable/chunks/TitleBar-7840ae1a.js";import"lodash";import"idb-keyval";/* empty css                                                                             */import"../../../../_app/immutable/chunks/index-2945f287.js";import"../../../../_app/immutable/chunks/ProgressBar-89c89d51.js";class u{constructor(e,t,s,i){this._name=e,this._size=t,this._path=s,this._archiveRef=i}get name(){return this._name}get size(){return this._size}extract(){return this._archiveRef.extractSingleFile(this._path)}}class n{static init(e={}){return n._options={workerUrl:"../dist/worker-bundle.js",...e},n._options}static open(e,t=null){return t=t||n._options||n.init()&&console.warn("Automatically initializing using options: ",n._options),new n(e,t).open()}constructor(e,t){this._worker=new Worker(t.workerUrl),this._worker.addEventListener("message",this._workerMsg.bind(this)),this._callbacks=[],this._content={},this._processed=0,this._file=e}async open(){return await this._postMessage({type:"HELLO"},(e,t,s)=>{s.type==="READY"&&e()}),await this._postMessage({type:"OPEN",file:this._file},(e,t,s)=>{s.type==="OPENED"&&e(this)})}hasEncryptedData(){return this._postMessage({type:"CHECK_ENCRYPTION"},(e,t,s)=>{s.type==="ENCRYPTION_STATUS"&&e(s.status)})}usePassword(e){return this._postMessage({type:"SET_PASSPHRASE",passphrase:e},(t,s,i)=>{i.type==="PASSPHRASE_STATUS"&&t(i.status)})}getFilesObject(){return this._processed>0?Promise.resolve().then(()=>this._content):this._postMessage({type:"LIST_FILES"},(e,t,s)=>{if(s.type==="ENTRY"){const i=s.entry,[r,o]=this._getProp(this._content,i.path);return i.type==="FILE"&&(r[o]=new u(i.fileName,i.size,i.path,this)),!0}else s.type==="END"&&(this._processed=1,e(this._cloneContent(this._content)))})}getFilesArray(){return this.getFilesObject().then(e=>this._objectToArray(e))}extractSingleFile(e){return this._postMessage({type:"EXTRACT_SINGLE_FILE",target:e},(t,s,i)=>{if(i.type==="FILE"){const r=new File([i.entry.fileData],i.entry.fileName,{type:"application/octet-stream"});t(r)}})}extractFiles(e){return this._processed>1?Promise.resolve().then(()=>this._content):this._postMessage({type:"EXTRACT_FILES"},(t,s,i)=>{if(i.type==="ENTRY"){const[r,o]=this._getProp(this._content,i.entry.path);return i.entry.type==="FILE"&&(r[o]=new File([i.entry.fileData],i.entry.fileName,{type:"application/octet-stream"}),e!==void 0&&setTimeout(e.bind(null,{file:r[o],path:i.entry.path}))),!0}else i.type==="END"&&(this._processed=2,this._worker.terminate(),t(this._cloneContent(this._content)))})}_cloneContent(e){if(e instanceof File||e instanceof u||e===null)return e;const t={};for(const s of Object.keys(e))t[s]=this._cloneContent(e[s]);return t}_objectToArray(e,t=""){const s=[];for(const i of Object.keys(e))e[i]instanceof File||e[i]instanceof u||e[i]===null?s.push({file:e[i]||i,path:t}):s.push(...this._objectToArray(e[i],`${t}${i}/`));return s}_getProp(e,t){const s=t.split("/");s[s.length-1]===""&&s.pop();let i=e,r=null;for(const o of s)i[o]=i[o]||{},r=i,i=i[o];return[r,s[s.length-1]]}_postMessage(e,t){return this._worker.postMessage(e),new Promise((s,i)=>{this._callbacks.push(this._msgHandler.bind(this,t,s,i))})}_msgHandler(e,t,s,i){if(i.type==="BUSY")s("worker is busy");else if(i.type==="ERROR")s(i.error);else return e(t,s,i)}_workerMsg({data:e}){const t=this._callbacks[this._callbacks.length-1];t(e)||this._callbacks.pop()}}const U=E((a,e,t,s)=>{let{id:i}=e,{window:r}=e,{self:o}=e,{parentNode:y}=e,{fs_item:l}=e,{exec_path:p}=e,{options:h={title:"WinRAR",min_width:250,min_height:220,width:250,height:220,resizable:!1,maximize_btn_disabled:!0,icon:"/images/xp/icons/RAR.png",id:i,exec_path:p}}=e;n.init({workerUrl:"/js/libarchive.js/dist/worker-bundle.js"});async function c(){N.update(f=>f.filter(w=>w!=o)),o.$destroy()}e.id===void 0&&t.id&&i!==void 0&&t.id(i),e.window===void 0&&t.window&&r!==void 0&&t.window(r),e.self===void 0&&t.self&&o!==void 0&&t.self(o),e.parentNode===void 0&&t.parentNode&&y!==void 0&&t.parentNode(y),e.fs_item===void 0&&t.fs_item&&l!==void 0&&t.fs_item(l),e.exec_path===void 0&&t.exec_path&&p!==void 0&&t.exec_path(p),e.options===void 0&&t.options&&h!==void 0&&t.options(h),e.destroy===void 0&&t.destroy&&c!==void 0&&t.destroy(c);let _,m;do _=!0,m=`${d(k,"Window").$$render(a,{options:h,on_click_close:c,this:r},{this:f=>{r=f,_=!1}},{content:()=>`<div slot="content" class="absolute inset-1 top-0 bg-xp-yellow">${`<div class="absolute inset-4 flex flex-col overflow-hidden justify-between"><p class="my-2 text-[13px] text-ellipsis line-clamp-3">Extracting ${v(l?l.name:"")}...</p>
                ${d(P,"DumbProgress").$$render(a,{style:"height:15px;margin:5px 0;flex-shrink:0;"},{},{})}
                ${d(x,"Button").$$render(a,{title:"Cancel",on_click:c},{},{})}</div>`}

        </div>`})}


`;while(!_);return m});export{U as default};
