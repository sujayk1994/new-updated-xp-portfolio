import{c as Y,a as I,v as R,e as Z,j as $}from"../../../../_app/immutable/chunks/index-ff400fad.js";import{W as ee}from"../../../../_app/immutable/chunks/Window-e98aeb2f.js";import{z as te,h as le,r as ie}from"../../../../_app/immutable/chunks/store-3e4ea696.js";import{b as re,s as ae,a as ne}from"../../../../_app/immutable/chunks/fs-8c49ae47.js";import oe from"short-uuid";import{D as fe}from"../../../../_app/immutable/chunks/DumbProgress-1d1763f5.js";import{Document as se,AlignmentType as m,Packer as de,Paragraph as b,TableCell as ce,TableRow as ue,Table as me,HeadingLevel as y,TextRun as he,ExternalHyperlink as pe,ImageRun as ge,VerticalPositionRelativeFrom as be,VerticalPositionAlign as ye,HorizontalPositionRelativeFrom as H,HorizontalPositionAlign as E,TextWrappingType as z,TextWrappingSide as O}from"docx";import"../../../../_app/immutable/chunks/TitleBar-7840ae1a.js";import"lodash";import"idb-keyval";import"../../../../_app/immutable/chunks/index-2945f287.js";import"../../../../_app/immutable/chunks/system-eda41220.js";import"../../../../_app/immutable/chunks/utils-a62a4de9.js";import"../../../../_app/immutable/chunks/finder-762cc408.js";import"buffer";import"../../../../_app/immutable/chunks/admin-04ad1b95.js";import"../../../../_app/immutable/chunks/ProgressBar-89c89d51.js";const we=["consolas","courier","courier new"];mammoth.transforms.paragraph(_e),mammoth.images.imgElement(function(l){return l.read().then(function(e){let t=new File([e],{type:l.contentType});return{src:URL.createObjectURL(t),width:l.width,height:l.height,style:l.style}})});function _e(l){var e=mammoth.transforms.getDescendantsOfType(l,"run"),t=e.length>0&&e.every(function(a){return a.font&&we.indexOf(a.font.toLowerCase())!==-1});return t?{...l,styleId:"code",styleName:"Code"}:l}const L={black:"000000",silver:"c0c0c0",gray:"808080",white:"ffffff",maroon:"800000",red:"ff0000",purple:"800080",fuchsia:"ff00ff",green:"008000",lime:"00ff00",olive:"808000",yellow:"ffff00",navy:"000080",blue:"0000ff",teal:"008080",aqua:"00ffff",aliceblue:"f0f8ff",antiquewhite:"faebd7",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",blanchedalmond:"ffebcd",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",oldlace:"fdf5e6",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",whitesmoke:"f5f5f5",yellowgreen:"9acd32"};async function M(l){let e=new DOMParser().parseFromString(l,"text/html"),t=[],a=Array.from(e.querySelectorAll("p,pre,table,h1,h2,h3,h4,h5,h6,ul,ol"));a=a.filter(n=>!a.filter(r=>r!=n).some(r=>r.contains(n)));for(let n of a){let r=a.indexOf(n);n.nodeName=="P"||n.nodeName=="PRE"?t.push(await ve(n)):n.nodeName=="TABLE"?t.push(await ke(n)):["H1","H2","H3","H4","H5","H6"].includes(n.nodeName)?t.push(await xe(n)):n.nodeName=="UL"?t.push(...await Ne(n,r)):n.nodeName=="OL"&&t.push(...await Se(n,r))}let i=new se({sections:[{children:t}],numbering:{config:[{reference:"arabic",levels:[{level:0,format:"decimal",text:"%1",alignment:m.START,style:{paragraph:{indent:{left:300,hanging:200}}}},{level:1,format:"decimal",text:"%1.%2",alignment:m.START,style:{paragraph:{indent:{left:600,hanging:200}}}}]}]}});return await de.toBlob(i)}async function ve(l){let e=P(l);e.size==null&&(e.size=24),e.font==null&&l.nodeName=="PRE"&&(e.font="Courier New");let t=await u(l,e),a=j(l),i=W(l);return l.parentElement.nodeName=="BLOCKQUOTE"&&(i.left==null&&(i.left={color:"cbd5e1",size:16,space:1,style:"single"}),(e.indent==null||e.indent.left==0)&&(e.indent={left:80})),new b({alignment:a,indent:e.indent,children:t,border:i})}async function ke(l){let e=[];for(let i of l.querySelectorAll("tr")){let o=[];for(let n of i.querySelectorAll("th, td"))o.push(new ce({children:[new b({children:await u(n)})]}));e.push(new ue({children:o}))}let t=l.querySelector("tr").querySelectorAll("th, td").length;return new me({rows:e,width:0,columnWidths:Array(t).fill(Math.floor(9638/t),0,t)})}async function xe(l){let e=P(l),t=await u(l,e),a=j(l),i;switch(l.nodeName){case"H1":i=y.HEADING_1;break;case"H2":i=y.HEADING_2;break;case"H3":i=y.HEADING_3;break;case"H4":i=y.HEADING_4;break;case"H5":i=y.HEADING_5;break;case"H6":i=y.HEADING_6;break}let o=W(l);return new b({alignment:a,children:t,indent:e.indent,heading:i,border:o})}async function Ne(l,e){let t=[];for(let a of l.querySelectorAll(":scope > li"))if(t.push(new b({children:await u(a),bullet:{level:0,instance:e}})),a.querySelectorAll!=null)for(let i of a.querySelectorAll("ul li"))t.push(new b({children:await u(i),bullet:{level:1,instance:e}}));return t}async function Se(l,e){let t=[];for(let a of l.querySelectorAll(":scope > li"))if(t.push(new b({children:await u(a),numbering:{reference:"arabic",instance:e,level:0}})),a.querySelectorAll!=null)for(let i of a.querySelectorAll("ol li"))t.push(new b({children:await u(i),numbering:{reference:"arabic",instance:e,level:1}}));return t}async function u(l,e){e==null&&(e={});let t=[],a=l.childNodes;for(let i of a)if(i.nodeName=="#text"){let o=new he({text:i.nodeValue,bold:e.bold,italics:e.italics,subScript:e.subScript,superScript:e.superScript,strike:e.strike,underline:e.underline?{}:null,color:e.color,shading:e.shading,size:e.size,allCaps:e.allCaps,font:e.font,style:e.style});t=[...t,o]}else if(i.nodeName=="A"&&i.getAttribute("href")){let o=new pe({children:await u(i,{style:"Hyperlink"}),link:i.getAttribute("href")});t=[...t,o]}else if(i.nodeName=="IMG"){let o=await re(i.src),n=Te(i),r=new ge({data:o,transformation:{width:i.width,height:i.height},floating:n});t=[...t,r]}else if(l.childNodes.length>0&&!["UL","OL"].includes(l.nodeName)){let o={...e,...P(i)};i.nodeName=="STRONG"&&(o.bold=!0),i.nodeName=="EM"&&(o.italics=!0),i.nodeName=="SUB"&&(o.subScript=!0),i.nodeName=="SUP"&&(o.superScript=!0),i.nodeName=="S"&&(o.strike=!0),i.nodeName=="U"&&(o.underline=!0),i.nodeName=="A"&&(o.anchor=i.getAttribute("href"),o.underline=!0),t=[...t,...await u(i,o)]}return t}function P(l){let e={},t=(l.getAttribute("style")||"").split(";");for(let n of t){let r=n.trim().split(":");r.length==2&&(e[r[0].trim()]=r[1].trim())}let a=g(e["background-color"]);a&&(e.shading={fill:a}),e.color=g(e.color),e["font-family"]&&(e.font=e["font-family"].split(",")[0],e.font&&(e.font=e.font.split("'").join(""))),e.size=p(e["font-size"]);let i=p(e["padding-left"]);isNaN(i)||(e.indent={left:i*10}),e["text-transform"]=="uppercase"&&(e.allCaps=!0),e["text-transform"]=="capitalize"&&(e.smallCaps=!0),e["text-decoration"]=="line-through"&&(e.strike=!0),e["text-decoration"]=="underline"&&(e.underline=!0),e["font-style"]=="italic"&&(e.italics=!0),(e["font-weight"]=="bold"||parseInt(e["font-weight"])>=700)&&(e.bold=!0);let o=["color","shading","size","indent","allCaps","allCaps","strike","font","italics","underline","bold"];for(let n of Object.keys(e))(!o.includes(n)||e[n]==null)&&delete e[n];return e}function p(l){if(l==null||l=="")return null;l=l.trim();let e;if(l.endsWith("pt")?e="pt":l.endsWith("px")&&(e="px"),e){let t=parseInt(l.split(e).join(""));return isNaN(t)?null:(e=="px"?t=2*Math.ceil(72*t/96):e=="pt"&&(t=2*t),t)}else return null}function g(l){if(l==null||l=="")return null;if(l=l.trim(),L[l]!=null)return L[l];let e;return l.includes("rgb")?e=Ae(l):e=l.split("#").join("").trim(),e.length==3&&(e=e+e),e==null||/^[0-9A-F]{6}$/i.test(e),e}function Ae(l){let e=l.indexOf(",")>-1?",":" ";l=l.substr(4).split(")")[0].split(e);let t=(+l[0]).toString(16),a=(+l[1]).toString(16),i=(+l[2]).toString(16);return t.length==1&&(t="0"+t),a.length==1&&(a="0"+a),i.length==1&&(i="0"+i),t+a+i}function W(l){let e={},t=(l.getAttribute("style")||"").split(";");for(let r of t){let s=r.trim().split(":");s.length==2&&(e[s[0].trim()]=s[1].trim())}let a,i,o,n;if(e.border!=null){let[r,s,...f]=e.border.split(" ");f=g(f.join("").trim()),r=p(r)*4,a={color:f,size:r,space:1,style:"single"},i={color:f,size:r,space:1,style:"single"},o={color:f,size:r,space:1,style:"single"},n={color:f,size:r,space:1,style:"single"}}if(e["border-left"]!=null){let[r,s,...f]=e["border-left"].split(" ");f=g(f.join("").trim()),r=p(r)*4,n={color:f,size:r,space:1,style:"single"}}if(e["border-right"]!=null){let[r,s,...f]=e["border-right"].split(" ");f=g(f.join("").trim()),r=p(r)*4,i={color:f,size:r,space:1,style:"single"}}if(e["border-top"]!=null){let[r,s,...f]=e["border-top"].split(" ");f=g(f.join("").trim()),r=p(r)*4,a={color:f,size:r,space:1,style:"single"}}if(e["border-bottom"]!=null){let[r,s,...f]=e["border-bottom"].split(" ");f=g(f.join("").trim()),r=p(r)*4,o={color:f,size:r,space:1,style:"single"}}return{top:a,right:i,bottom:o,left:n}}function Te(l){let e={},t=(l.getAttribute("style")||"").split(";");for(let o of t){let n=o.trim().split(":");n.length==2&&(e[n[0].trim()]=n[1].trim())}let a={relative:be.TOP_MARGIN,align:ye.TOP},i={top:36e4,right:36e4,bottom:36e4,left:36e4};return e["margin-left"]=="auto"&&e["margin-right"]=="auto"?{horizontalPosition:{relative:H.COLUMN,align:E.CENTER},verticalPosition:a,margin:i,wrap:{type:z.TOP_AND_BOTTOM,side:O.BOTH_SIDES}}:e.float=="left"?{horizontalPosition:{relative:H.COLUMN,align:E.LEFT},verticalPosition:a,margin:i,wrap:{type:z.SQUARE,side:O.RIGHT}}:e.float=="right"?{horizontalPosition:{relative:H.COLUMN,align:E.RIGHT},verticalPosition:a,margin:i,wrap:{type:z.SQUARE,side:O.LEFT}}:null}function j(l){let e=l.getAttribute("style");if(e==null)return m.LEFT;let t={};for(let a of e.split(";")){if(a.split(":").length!=2)continue;let i=a.split(":")[0].trim(),o=a.split(":")[1].trim();t[i]=o}switch(t["text-align"]){case"left":return m.LEFT;case"center":return m.CENTER;case"justify":return m.JUSTIFIED;case"right":return m.RIGHT;default:return m.LEFT}}let F="Microsoft Word";async function He({node_ref:l,filetypes:e,id:t,current_filetype:a}){return new Promise(async(i,o)=>{const n=(await import("../../../../_app/immutable/chunks/SaveModal-661c5409.js")).default;let r=new n({target:l,props:{filetypes:e,selected_filetype:a,id:t}});r.self=r,r.on_save=()=>{i({parent_id:r.parent_id,filename:r.filename,selected_filetype:r.selected_filetype}),r.destroy()}})}async function Ee({node_ref:l,title:e,message:t,icon:a,yes_action:i,no_action:o}){const n=(await import("../../../../_app/immutable/chunks/Dialog-20b8e919.js")).default;let r=[{name:"Save",action:()=>{i(),s.destroy()},focus:!0},{name:"Don't Save",action:()=>{o(),s.destroy()}},{name:"Cancel",action:()=>{s.destroy()}}],s=new n({target:l,props:{icon:a,title:e,message:t,buttons:r,button_align:"center"}});s.self=s}const Ve=Y((l,e,t,a)=>{let i,o,n;i=I(te,d=>d),n=I(le,d=>o=d);let{id:r}=e,{window:s}=e,{self:f}=e,{parentNode:q}=e,{fs_item:c}=e,{exec_path:k}=e,_,w=[{name:"Microsoft Word (OpenXML)",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",ext:".docx"}];w=w.map(d=>(d.name=d.name+" ("+d.ext+")",d));async function x(){if(_.contentWindow.is_dirty()){let d=()=>{N()},h=async()=>{await U(),N()};Ee({node_ref:s.node_ref,title:"Save Changes",message:"Do you want to save the changes you've made before closing this document?",yes_action:h,no_action:d})}else N()}function N(){ie.update(d=>d.filter(h=>h!=f)),f.$destroy()}let S={width:document.querySelector("#work-space").offsetWidth,height:document.querySelector("#work-space").offsetHeight},{options:A={title:F,min_width:500,min_height:400,width:Math.min(S.width-20,(S.height-20)*1.6),height:Math.min(S.height-20),icon:"/images/xp/icons/MSWord.png",id:r,exec_path:k}}=e;async function U(){if(c!=null){c?.ext;let d=_.contentWindow.get_content(),h=await M(d),v=new File([h],c.name);await ae(c.id,v),s.show_toast({message:"Changes Saved!"})}else await G()}async function G(){console.log(c);let d=w.find(X=>X.ext==c?.ext);d==null&&(d=w[0]);let{parent_id:h,filename:v,selected_filetype:Q}=await He({id:c?.parent,node_ref:s.node_ref,filetypes:w,current_filetype:d}),V=_.contentWindow.get_content(),J=await M(V),K=new File([J],v),C=oe.generate();await ne(v,Q.ext,K,h,C),c==null&&(c=o[C])}function B(){setTimeout(()=>{},500)}e.id===void 0&&t.id&&r!==void 0&&t.id(r),e.window===void 0&&t.window&&s!==void 0&&t.window(s),e.self===void 0&&t.self&&f!==void 0&&t.self(f),e.parentNode===void 0&&t.parentNode&&q!==void 0&&t.parentNode(q),e.fs_item===void 0&&t.fs_item&&c!==void 0&&t.fs_item(c),e.exec_path===void 0&&t.exec_path&&k!==void 0&&t.exec_path(k),e.destroy===void 0&&t.destroy&&x!==void 0&&t.destroy(x),e.options===void 0&&t.options&&A!==void 0&&t.options(A);let T,D;do{T=!0;{let d="";c?d=c.name:d=F,s&&s.update_title(d)}D=`${R(ee,"Window").$$render(l,{options:A,on_click_close:x,on_focused:B,this:s},{this:d=>{s=d,T=!1}},{content:()=>`<div slot="content" class="absolute inset-0.5 top-0 flex flex-col"><div class="absolute inset-0 overflow-auto bg-slate-400 font-sans">${`<div class="absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 text-slate-500 text-sm p-2 rounded font-mono">${R(fe,"DumbProgress").$$render(l,{style:"width:150px;height:15px;"},{},{})}</div>`}

            <iframe src="/html/msword/index.html" class="${"w-full h-full "+Z("opacity-0",!0)}"${$("this",_,0)}></iframe></div></div>`})}



`}while(!T);return i(),n(),D});export{Ve as default};
